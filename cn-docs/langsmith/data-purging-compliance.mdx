---
title: 合规性数据清除
sidebarTitle: Data purging for compliance
---
本指南介绍了数据到达 LangSmith Cloud 服务器后可用的各项功能，以帮助您实现隐私目标。

## 数据保留

LangSmith 提供自动数据保留功能，以协助合规性和存储管理。数据保留策略可在组织和项目级别进行配置。

有关数据保留配置和管理的详细信息，请参阅 [数据保留概念](/langsmith/administration-overview#data-retention) 文档。

## 追踪记录删除

您可以使用 API 完成追踪记录删除。API 支持两种删除追踪记录的方法：

1. **通过追踪 ID 和会话 ID**：通过提供追踪 ID 列表及其对应的会话 ID 来删除特定的追踪记录（每个请求最多 1000 条追踪记录）
2. **通过元数据**：删除工作区内匹配任何指定元数据键值对的追踪记录

更多详情，请参阅 [API 规范](https://api.smith.langchain.com/redoc#tag/run/operation/delete_runs_api_v1_runs_delete_post)。

<Warning>
所有追踪记录删除操作都将删除所有数据存储中的相关实体，如反馈、聚合和统计信息。
</Warning>

### 删除时间线

追踪记录删除在非高峰使用时段处理，并非即时完成。LangChain 在周末运行删除作业。删除操作没有确认信息——您需要再次查询数据以验证其是否已被移除。

### 删除特定追踪记录

要通过追踪 ID 从单个会话中删除特定的追踪记录：

<Note>
`session_id` 是您要删除的追踪记录所属项目的 ID。您可以在 LangSmith UI 的追踪项目页面上找到它。
</Note>

```bash
curl -X POST "https://api.smith.langchain.com/api/v1/runs/delete" \
  -H "x-api-key: YOUR_API_KEY" \
  -H "Content-Type: application/json" \
  -d '{
    "trace_ids": ["trace-id-1", "trace-id-2", "trace-id-3"],
    "session_id": "session-id-1"
  }'
```

### 按元数据删除

按元数据删除时：

- 接受一个键/值对组成的 `metadata` 对象。键值对匹配使用 **或** 条件。如果追踪记录的元数据中包含指定的元数据键值对中的 **任意一个**（而非全部），则该追踪记录将被匹配。
- 按元数据删除时，无需指定会话 ID。删除操作将应用于整个工作区。

要基于元数据在工作区内删除追踪记录（匹配 **任意** 指定的元数据键值对）：

```bash
curl -X POST "https://api.smith.langchain.com/api/v1/runs/delete" \
  -H "x-api-key: YOUR_API_KEY" \
  -H "Content-Type: application/json" \
  -d '{
    "metadata": {
      "user_id": "user123",
      "environment": "staging"
    }
  }'
```

这将删除元数据中包含 `user_id: "user123"` **或** `environment: "staging"` 的追踪记录。

<Warning>
请记住，每个请求每个会话最多只能安排删除 1000 条追踪记录。对于更大的删除操作，您需要进行多次请求。
</Warning>

## 数据集示例删除

您可以通过我们的 API 自助删除数据集示例，该 API 根据您的数据保留需求支持软删除和硬删除两种方法。

<Warning>
硬删除将永久移除指定示例在整个数据集历史中所有版本的输入、输出和元数据。
</Warning>

### 删除示例是一个两步过程

对于批量操作，示例删除遵循两步流程：

#### 1. 按元数据搜索示例

查找工作区内所有数据集中具有匹配元数据的示例。

[GET /examples](https://api.smith.langchain.com/redoc#tag/examples/operation/read_examples_api_v1_examples_get)

- `as_of` 必须明确指定为时间戳。只有在此 `as_of` 日期之前创建的示例才会被返回

```bash
curl -X GET "https://api.smith.langchain.com/api/v1/examples?as_of=2024-01-01T00:00:00Z" \
  -H "x-api-key: YOUR_API_KEY" \
  -H "Content-Type: application/json" \
  -d '{
    "metadata": {
      "user_id": "user123",
      "environment": "staging"
    }
  }'
```

这将返回您工作区内所有数据集中，元数据包含 `user_id: "user123"` **或** `environment: "staging"` 的示例。

#### 2. 硬删除示例

获取示例 ID 后，发送删除请求。这将把该示例在数据集所有版本中的输入、输出和元数据清零。

[POST /v1/platform/datasets/examples/delete/](https://api.smith.langchain.com/redoc?#tag/examples/paths/~1v1~1platform~1datasets~1examples~1delete/post)

- 在请求体中指定 `example_ids`（示例 ID 列表）和 `hard_delete`（布尔值）

```bash
curl -X POST "https://api.smith.langchain.com/v1/platform/datasets/examples/delete/" \
  -H "x-api-key: YOUR_API_KEY" \
  -H "Content-Type: application/json" \
  -d '{
    "example_ids": ["example-id-1", "example-id-2", "example-id-3"],
    "hard_delete": true
  }'
```

### 删除类型

#### 软删除（默认）

- 在数据集中创建输入/输出为 NULL 的墓碑条目
- 保留历史数据并维护数据集版本控制
- 仅影响数据集的当前版本

#### 硬删除

- 永久移除所有数据集版本中的输入、输出和元数据
- 当合规性要求在所有版本中清零数据时，进行完全的数据移除
- 在请求体中设置 `"hard_delete": true`
