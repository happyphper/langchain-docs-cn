---
title: QdrantVectorStore
---
<Tip>
**兼容性**：仅适用于 Node.js。
</Tip>

[Qdrant](https://qdrant.tech/) 是一个向量相似性搜索引擎。它提供了一个生产就绪的服务，并配有便捷的 API，用于存储、搜索和管理点（points）——即带有额外载荷（payload）的向量。

本指南提供了快速入门 Qdrant [向量存储](/oss/integrations/vectorstores) 的概述。有关 `QdrantVectorStore` 所有功能和配置的详细文档，请参阅 [API 参考](https://api.js.langchain.com/classes/langchain_qdrant.QdrantVectorStore.html)。

## 概述

### 集成详情

| 类 | 包 | [Python 支持](https://python.langchain.com/docs/integrations/vectorstores/qdrant/) | 版本 |
| :--- | :--- | :---: | :---: |
| [`QdrantVectorStore`](https://api.js.langchain.com/classes/langchain_qdrant.QdrantVectorStore.html) | [`@langchain/qdrant`](https://npmjs.com/@langchain/qdrant) | ✅ |  ![NPM - Version](https://img.shields.io/npm/v/@langchain/qdrant?style=flat-square&label=%20&) |

## 设置

要使用 Qdrant 向量存储，你需要设置一个 Qdrant 实例并安装 `@langchain/qdrant` 集成包。

本指南还将使用 [OpenAI 嵌入](/oss/integrations/text_embedding/openai)，这需要你安装 `@langchain/openai` 集成包。你也可以根据需要使用 [其他支持的嵌入模型](/oss/integrations/text_embedding)。

<CodeGroup>
```bash npm
npm install @langchain/qdrant @langchain/core @langchain/openai
```
```bash yarn
yarn add @langchain/qdrant @langchain/core @langchain/openai
```
```bash pnpm
pnpm add @langchain/qdrant @langchain/core @langchain/openai
```
</CodeGroup>

安装完所需的依赖项后，按照 [Qdrant 设置说明](https://qdrant.tech/documentation/quickstart/) 在你的计算机上使用 Docker 运行一个 Qdrant 实例。注意你的容器运行的 URL。

### 凭证

完成上述步骤后，设置一个 `QDRANT_URL` 环境变量：

```typescript
// 例如 http://localhost:6333
process.env.QDRANT_URL = "your-qdrant-url"
```

如果你在本指南中使用 OpenAI 嵌入，你还需要设置你的 OpenAI 密钥：

```typescript
process.env.OPENAI_API_KEY = "YOUR_API_KEY";
```

如果你想获取模型调用的自动追踪，你也可以通过取消下面的注释来设置你的 [LangSmith](https://docs.langchain.com/langsmith/home) API 密钥：

```typescript
// process.env.LANGSMITH_TRACING="true"
// process.env.LANGSMITH_API_KEY="your-api-key"
```

## 实例化

```typescript
import { QdrantVectorStore } from "@langchain/qdrant";
import { OpenAIEmbeddings } from "@langchain/openai";

const embeddings = new OpenAIEmbeddings({
  model: "text-embedding-3-small",
});

const vectorStore = await QdrantVectorStore.fromExistingCollection(embeddings, {
  url: process.env.QDRANT_URL,
  collectionName: "langchainjs-testing",
});
```

## 管理向量存储

### 向向量存储添加项目

```typescript
import type { Document } from "@langchain/core/documents";

const document1: Document = {
  pageContent: "细胞中的能量工厂是线粒体",
  metadata: { source: "https://example.com" }
};

const document2: Document = {
  pageContent: "建筑物由砖块构成",
  metadata: { source: "https://example.com" }
};

const document3: Document = {
  pageContent: "线粒体由脂质构成",
  metadata: { source: "https://example.com" }
};

const document4: Document = {
  pageContent: "2024 年奥运会在巴黎举行",
  metadata: { source: "https://example.com" }
}

const documents = [document1, document2, document3, document4];

await vectorStore.addDocuments(documents);
```

目前不支持顶层的文档 ID 和删除操作。

## 查询向量存储

一旦你的向量存储创建完成并且相关文档已添加，你很可能会希望在运行链（chain）或代理（agent）时查询它。

### 直接查询

执行简单的相似性搜索可以按如下方式进行：

```typescript
const filter = {
  "must": [
      { "key": "metadata.source", "match": { "value": "https://example.com" } },
  ]
};

const similaritySearchResults = await vectorStore.similaritySearch("biology", 2, filter);

for (const doc of similaritySearchResults) {
  console.log(`* ${doc.pageContent} [${JSON.stringify(doc.metadata, null)}]`);
}
```

```text
* 细胞中的能量工厂是线粒体 [{"source":"https://example.com"}]
* 线粒体由脂质构成 [{"source":"https://example.com"}]
```

有关 Qdrant 过滤器语法的更多信息，请参阅 [此页面](https://qdrant.tech/documentation/concepts/filtering/)。注意，所有值都必须以 `metadata.` 为前缀。

如果你想执行相似性搜索并获取相应的分数，可以运行：

```typescript
const similaritySearchWithScoreResults = await vectorStore.similaritySearchWithScore("biology", 2, filter)

for (const [doc, score] of similaritySearchWithScoreResults) {
  console.log(`* [SIM=${score.toFixed(3)}] ${doc.pageContent} [${JSON.stringify(doc.metadata)}]`);
}
```

```text
* [SIM=0.165] 细胞中的能量工厂是线粒体 [{"source":"https://example.com"}]
* [SIM=0.148] 线粒体由脂质构成 [{"source":"https://example.com"}]
```

### 通过转换为检索器进行查询

你也可以将向量存储转换为 [检索器（retriever）](/oss/langchain/retrieval)，以便在你的链中更轻松地使用。

```typescript
const retriever = vectorStore.asRetriever({
  // 可选过滤器
  filter: filter,
  k: 2,
});
await retriever.invoke("biology");
```

```javascript
[
  Document {
    pageContent: '细胞中的能量工厂是线粒体',
    metadata: { source: 'https://example.com' },
    id: undefined
  },
  Document {
    pageContent: '线粒体由脂质构成',
    metadata: { source: 'https://example.com' },
    id: undefined
  }
]
```

### 用于检索增强生成（RAG）

有关如何使用此向量存储进行检索增强生成（RAG）的指南，请参阅以下部分：

- [使用 LangChain 构建 RAG 应用](/oss/langchain/rag)。
- [智能体 RAG](/oss/langgraph/agentic-rag)
- [检索文档](/oss/langchain/retrieval)

---

## API 参考

有关 `QdrantVectorStore` 所有功能和配置的详细文档，请参阅 [API 参考](https://api.js.langchain.com/classes/langchain_qdrant.QdrantVectorStore.html)。
