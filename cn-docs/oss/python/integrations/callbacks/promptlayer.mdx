---
title: PromptLayer
---
>[PromptLayer](https://docs.promptlayer.com/introduction) æ˜¯ä¸€ä¸ªç”¨äºæç¤ºå·¥ç¨‹ï¼ˆprompt engineeringï¼‰çš„å¹³å°ã€‚å®ƒè¿˜èƒ½é€šè¿‡å¯è§†åŒ–è¯·æ±‚ã€ç‰ˆæœ¬åŒ–æç¤ºè¯å’Œè¿½è¸ªä½¿ç”¨æƒ…å†µæ¥å¸®åŠ©å®ç° LLM çš„å¯è§‚æµ‹æ€§ã€‚

è™½ç„¶ `PromptLayer` ç¡®å®æœ‰ç›´æ¥ä¸ LangChain é›†æˆçš„ LLMï¼ˆä¾‹å¦‚ [`PromptLayerOpenAI`](/oss/integrations/llms/promptlayer_openai)ï¼‰ï¼Œä½†ä½¿ç”¨å›è°ƒï¼ˆcallbackï¼‰æ˜¯å°† `PromptLayer` ä¸ LangChain é›†æˆçš„æ¨èæ–¹å¼ã€‚

åœ¨æœ¬æŒ‡å—ä¸­ï¼Œæˆ‘ä»¬å°†ä»‹ç»å¦‚ä½•è®¾ç½® `PromptLayerCallbackHandler`ã€‚

æ›´å¤šä¿¡æ¯è¯·å‚é˜… [PromptLayer æ–‡æ¡£](https://docs.promptlayer.com/languages/langchain)ã€‚

## å®‰è£…ä¸è®¾ç½®

```python
pip install -qU  langchain-community promptlayer --upgrade
```

### è·å– API å‡­è¯

å¦‚æœæ‚¨æ²¡æœ‰ PromptLayer è´¦æˆ·ï¼Œè¯·åœ¨ [promptlayer.com](https://www.promptlayer.com) ä¸Šåˆ›å»ºä¸€ä¸ªã€‚ç„¶åï¼Œé€šè¿‡ç‚¹å‡»å¯¼èˆªæ ä¸­çš„è®¾ç½®é½¿è½®å›¾æ ‡è·å– API å¯†é’¥ï¼Œå¹¶å°†å…¶è®¾ç½®ä¸ºåä¸º `PROMPTLAYER_API_KEY` çš„ç¯å¢ƒå˜é‡ã€‚

## ä½¿ç”¨æ–¹æ³•

å¼€å§‹ä½¿ç”¨ `PromptLayerCallbackHandler` ç›¸å½“ç®€å•ï¼Œå®ƒæ¥å—ä¸¤ä¸ªå¯é€‰å‚æ•°ï¼š

1.  `pl_tags` - ä¸€ä¸ªå¯é€‰çš„å­—ç¬¦ä¸²åˆ—è¡¨ï¼Œå°†åœ¨ PromptLayer ä¸Šä½œä¸ºæ ‡ç­¾ï¼ˆtagsï¼‰è¢«è¿½è¸ªã€‚
2.  `pl_id_callback` - ä¸€ä¸ªå¯é€‰å‡½æ•°ï¼Œè¯¥å‡½æ•°å°†ä»¥ `promptlayer_request_id` ä½œä¸ºå‚æ•°ã€‚æ­¤ ID å¯ä¸ PromptLayer çš„æ‰€æœ‰è¿½è¸ªåŠŸèƒ½ä¸€èµ·ä½¿ç”¨ï¼Œä»¥è¿½è¸ªå…ƒæ•°æ®ã€è¯„åˆ†å’Œæç¤ºè¯ä½¿ç”¨æƒ…å†µã€‚

## ç®€å•çš„ OpenAI ç¤ºä¾‹

åœ¨è¿™ä¸ªç®€å•çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬å°† `PromptLayerCallbackHandler` ä¸ @[`ChatOpenAI`] ä¸€èµ·ä½¿ç”¨ã€‚æˆ‘ä»¬æ·»åŠ äº†ä¸€ä¸ªåä¸º `chatopenai` çš„ PromptLayer æ ‡ç­¾ã€‚

```python
import promptlayer  # åˆ«å¿˜äº†è¿™ä¸ª ğŸ°
from langchain_community.callbacks.promptlayer_callback import (
    PromptLayerCallbackHandler,
)
```

```python
from langchain.messages import HumanMessage
from langchain_openai import ChatOpenAI

chat_llm = ChatOpenAI(
    temperature=0,
    callbacks=[PromptLayerCallbackHandler(pl_tags=["chatopenai"])],
)
llm_results = chat_llm.invoke(
    [
        HumanMessage(content="What comes after 1,2,3 ?"),
        HumanMessage(content="Tell me another joke?"),
    ]
)
print(llm_results)
```

## GPT4All ç¤ºä¾‹

```python
from langchain_community.llms import GPT4All

model = GPT4All(model="./models/gpt4all-model.bin", n_ctx=512, n_threads=8)
callbacks = [PromptLayerCallbackHandler(pl_tags=["langchain", "gpt4all"])]

response = model.invoke(
    "Once upon a time, ",
    config={"callbacks": callbacks},
)
```

## å®Œæ•´åŠŸèƒ½ç¤ºä¾‹

åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬å°†è§£é” `PromptLayer` æ›´å¼ºå¤§çš„åŠŸèƒ½ã€‚

PromptLayer å…è®¸æ‚¨å¯è§†åŒ–åœ°åˆ›å»ºã€ç‰ˆæœ¬åŒ–å’Œè¿½è¸ªæç¤ºè¯æ¨¡æ¿ã€‚ä½¿ç”¨ [æç¤ºè¯æ³¨å†Œè¡¨ï¼ˆPrompt Registryï¼‰](https://docs.promptlayer.com/features/prompt-registry)ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ç¼–ç¨‹æ–¹å¼è·å–åä¸º `example` çš„æç¤ºè¯æ¨¡æ¿ã€‚

æˆ‘ä»¬è¿˜å®šä¹‰äº†ä¸€ä¸ª `pl_id_callback` å‡½æ•°ï¼Œè¯¥å‡½æ•°æ¥æ”¶ `promptlayer_request_id` å¹¶è®°å½•è¯„åˆ†ã€å…ƒæ•°æ®ï¼Œå¹¶å…³è”æ‰€ä½¿ç”¨çš„æç¤ºè¯æ¨¡æ¿ã€‚æœ‰å…³è¿½è¸ªçš„æ›´å¤šä¿¡æ¯ï¼Œè¯·é˜…è¯»[æˆ‘ä»¬çš„æ–‡æ¡£](https://docs.promptlayer.com/features/prompt-history/request-id)ã€‚

```python
from langchain_openai import OpenAI


def pl_id_callback(promptlayer_request_id):
    print("prompt layer id ", promptlayer_request_id)
    promptlayer.track.score(
        request_id=promptlayer_request_id, score=100
    )  # score is an integer 0-100
    promptlayer.track.metadata(
        request_id=promptlayer_request_id, metadata={"foo": "bar"}
    )  # metadata is a dictionary of key value pairs that is tracked on PromptLayer
    promptlayer.track.prompt(
        request_id=promptlayer_request_id,
        prompt_name="example",
        prompt_input_variables={"product": "toasters"},
        version=1,
    )  # link the request to a prompt template


openai_llm = OpenAI(
    model_name="gpt-3.5-turbo-instruct",
    callbacks=[PromptLayerCallbackHandler(pl_id_callback=pl_id_callback)],
)

example_prompt = promptlayer.prompts.get("example", version=1, langchain=True)
openai_llm.invoke(example_prompt.format(product="toasters"))
```

å°±è¿™ä¹ˆç®€å•ï¼è®¾ç½®å®Œæˆåï¼Œæ‚¨çš„æ‰€æœ‰è¯·æ±‚éƒ½ä¼šæ˜¾ç¤ºåœ¨ PromptLayer ä»ªè¡¨æ¿ä¸Šã€‚
æ­¤å›è°ƒä¹Ÿé€‚ç”¨äº LangChain ä¸Šå®ç°çš„ä»»ä½• LLMã€‚
