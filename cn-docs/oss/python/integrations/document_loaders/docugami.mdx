---
title: Docugami
---
本笔记本介绍了如何从 `Docugami` 加载文档。它阐述了使用此系统相较于其他数据加载器的优势。

## 先决条件

1.  安装必要的 Python 包。
2.  获取您工作区的访问令牌，并确保将其设置为 `DOCUGAMI_API_KEY` 环境变量。
3.  获取一些已处理文档的文档集（docset）和文档 ID，具体说明请参见：[help.docugami.com/home/docugami-api](https://help.docugami.com/home/docugami-api)

```python
# 您需要 dgml-utils 包来使用 DocugamiLoader（如果不使用 poetry，请直接运行 pip install，无需 "poetry run"）
!poetry run pip install docugami-langchain dgml-utils==0.3.0 --upgrade --quiet
```

## 快速开始

1.  创建一个 [Docugami 工作区](http://www.docugami.com)（提供免费试用）。
2.  添加您的文档（PDF、DOCX 或 DOC），并允许 Docugami 摄取它们并将其聚类成相似的文档集，例如 NDA、租赁协议和服务协议。系统支持的文档类型没有固定限制，创建的集群取决于您的特定文档，您之后可以[更改文档集分配](https://help.docugami.com/home/working-with-the-doc-sets-view)。
3.  通过您工作区的开发者平台创建一个访问令牌。[详细说明](https://help.docugami.com/home/docugami-api)
4.  探索 [Docugami API](https://api-docs.docugami.com) 以获取您已处理文档集的 ID 列表，或仅获取特定文档集的文档 ID。
6.  如下文详述使用 DocugamiLoader，为您的文档获取丰富的语义块。
7.  （可选）构建并发布一个或多个[报告或摘要](https://help.docugami.com/home/reports)。这有助于 Docugami 根据您的偏好改进语义 XML，提供更好的标签，然后这些标签会作为元数据添加到 DocugamiLoader 的输出中。使用自查询检索器（self-querying retriever）等技术进行高精度的文档问答。

## 与其他分块技术相比的优势

对文档进行适当的分块对于从文档中检索至关重要。存在许多分块技术，包括依赖空白的简单分块和基于字符长度的递归分块拆分。Docugami 提供了一种不同的方法：

1.  **智能分块：** Docugami 将每个文档分解成一个层次化的语义 XML 树，其中包含大小不一的块，从单个单词或数值到整个章节。这些块遵循文档的语义轮廓，提供了比任意长度或基于简单空白的分块更有意义的表示。
2.  **语义标注：** 块被标注了在文档集中保持一致的语义标签，便于跨多个文档进行一致的层次化查询，即使这些文档的编写和格式不同。例如，在一组租赁协议中，您可以轻松识别关键条款，如房东、租户或续租日期，以及更复杂的信息，例如任何转租条款的措辞，或特定司法管辖区在终止条款中是否有例外部分。
3.  **结构化表示：** 此外，XML 树使用表示标题、段落、列表、表格和其他常见元素的属性，指示每个文档的结构轮廓，并在所有支持的文档格式（如扫描的 PDF 或 DOCX 文件）中保持一致。它适当地处理长文档的特性，如页眉/页脚或多列流，以实现干净的文本提取。
4.  **附加元数据：** 如果用户一直在使用 Docugami，块还会被标注附加的元数据。这些附加元数据可用于进行高精度的文档问答，而不受上下文窗口限制。请参阅下面的详细代码演练。

```python
import os

from docugami_langchain.document_loaders import DocugamiLoader
```

## 加载文档

如果设置了 DOCUGAMI_API_KEY 环境变量，则无需显式传递给加载器；否则，您可以将其作为 `access_token` 参数传入。

```python
DOCUGAMI_API_KEY = os.environ.get("DOCUGAMI_API_KEY")
```

```python
docset_id = "26xpy3aes7xp"
document_ids = ["d7jqdzcj50sj", "cgd1eacfkchw"]

# 要加载给定文档集 ID 中的所有文档，只需不提供 document_ids
loader = DocugamiLoader(docset_id=docset_id, document_ids=document_ids)
chunks = loader.load()
len(chunks)
```

```text
120
```

每个 @[`Document`]（实际上是实际 PDF、DOC 或 DOCX 的一个块）的 `metadata` 包含一些有用的附加信息：

1.  **id 和 source：** 块在 Docugami 中来源的文件（PDF、DOC 或 DOCX）的 ID 和名称。
2.  **xpath：** 块在文档 XML 表示中的 XPath。对于直接引用文档 XML 中实际块的来源引用非常有用。
3.  **structure：** 块的结构属性，例如 h1、h2、div、table、td 等。如果调用方需要过滤掉某些类型的块，这很有用。
4.  **tag：** 块的语义标签，使用各种生成式和抽取式技术。更多细节请参见：[github.com/docugami/DFM-benchmarks](https://github.com/docugami/DFM-benchmarks)

您可以通过在 `DocugamiLoader` 实例上设置以下属性来控制分块行为：

1.  您可以设置最小和最大块大小，系统会尽量遵守并最小化截断。您可以设置 `loader.min_text_length` 和 `loader.max_text_length` 来控制这些。
2.  默认情况下，只返回块的文本。但是，Docugami 的 XML 知识图谱包含额外的丰富信息，包括块内实体的语义标签。如果您希望在返回的块上获得额外的 xml 元数据，请设置 `loader.include_xml_tags = True`。
3.  此外，如果您希望 Docugami 在返回的块中包含父块，可以设置 `loader.parent_hierarchy_levels`。子块通过 `loader.parent_id_key` 值指向父块。这对于例如使用多向量检索器（MultiVector Retriever）进行[从小到大的检索](https://www.youtube.com/watch?v=ihSiRrOUwmg)很有用。请参阅本笔记本后面的详细示例。

```python
loader.min_text_length = 64
loader.include_xml_tags = True
chunks = loader.load()

for chunk in chunks[:5]:
    print(chunk)
```

```python
page_content='MASTER SERVICES AGREEMENT\n <ThisServicesAgreement> This Services Agreement (the “Agreement”) sets forth terms under which <Company>MagicSoft, Inc. </Company>a <Org><USState>Washington </USState>Corporation </Org>(“Company”) located at <CompanyAddress><CompanyStreetAddress><Company>600 </Company><Company>4th Ave</Company></CompanyStreetAddress>, <Company>Seattle</Company>, <Client>WA </Client><ProvideServices>98104 </ProvideServices></CompanyAddress>shall provide services to <Client>Daltech, Inc.</Client>, a <Company><USState>Washington </USState>Corporation </Company>(the “Client”) located at <ClientAddress><ClientStreetAddress><Client>701 </Client><Client>1st St</Client></ClientStreetAddress>, <Client>Kirkland</Client>, <State>WA </State><Client>98033</Client></ClientAddress>. This Agreement is effective as of <EffectiveDate>February 15, 2021 </EffectiveDate>(“Effective Date”). </ThisServicesAgreement>' metadata={'xpath': '/dg:chunk/docset:MASTERSERVICESAGREEMENT-section/dg:chunk', 'id': 'c28554d0af5114e2b102e6fc4dcbbde5', 'name': 'Master Services Agreement - Daltech.docx', 'source': 'Master Services Agreement - Daltech.docx', 'structure': 'h1 p', 'tag': 'chunk ThisServicesAgreement', 'Liability': '', 'Workers Compensation Insurance': '$1,000,000', 'Limit': '$1,000,000', 'Commercial General Liability Insurance': '$2,000,000', 'Technology Professional Liability Errors Omissions Policy': '$5,000,000', 'Excess Liability Umbrella Coverage': '$9,000,000', 'Client': 'Daltech, Inc.', 'Services Agreement Date': 'INITIAL STATEMENT  OF WORK (SOW)  The purpose of this SOW is to describe the Software and Services that Company will initially provide to  Daltech, Inc.  the “Client”) under the terms and conditions of the  Services Agreement  entered into between the parties on  June 15, 2021', 'Completion of the Services by Company Date': 'February 15, 2022', 'Charge': 'one hundred percent (100%)', 'Company': 'MagicSoft, Inc.', 'Effective Date': 'February 15, 2021', 'Start Date': '03/15/2021', 'Scheduled Onsite Visits Are Cancelled': 'ten (10) working days', 'Limit on Liability': '', 'Liability Cap': '', 'Business Automobile Liability': 'Business Automobile Liability  covering all vehicles that Company owns, hires or leases with a limit of no less than  $1,000,000  (combined single limit for bodily injury and property damage) for each accident.', 'Contractual Liability Coverage': 'Commercial General Liability insurance including  Contractual Liability Coverage , with coverage for products liability, completed operations, property damage and bodily injury, including  death , with an aggregate limit of no less than  $2,000,000 . This policy shall name Client as an additional insured with respect to the provision of services provided under this Agreement. This policy shall include a waiver of subrogation against Client.', 'Technology Professional Liability Errors Omissions': 'Technology Professional Liability Errors & Omissions policy (which includes Cyber Risk coverage and Computer Security and Privacy Liability coverage) with a limit of no less than  $5,000,000  per occurrence and in the aggregate.'}
page_content='A. STANDARD SOFTWARE AND SERVICES AGREEMENT\n 1. Deliverables.\n Company shall provide Client with software, technical support, product management, development, and <_testRef>testing </_testRef>services (“Services”) to the Client as described on one or more Statements of Work signed by Company and Client that reference this Agreement (“SOW” or “Statement of Work”). Company shall perform Services in a prompt manner and have the final product or service (“Deliverable”) ready for Client no later than the due date specified in the applicable SOW (“Completion Date”). This due date is subject to change in accordance with the Change Order process defined in the applicable SOW. Client shall assist Company by promptly providing all information requests known or available and relevant to the Services in a timely manner.' metadata={'xpath': '/dg:chunk/docset:MASTERSERVICESAGREEMENT-section/docset:MASTERSERVICESAGREEMENT/dg:chunk[1]/docset:Standard/dg:chunk[1]/dg:chunk[1]', 'id': 'de60160d328df10fa2637637c803d2d4', 'name': 'Master Services Agreement - Daltech.docx', 'source': 'Master Services Agreement - Daltech.docx', 'structure': 'lim h1 lim h1 div', 'tag': 'chunk', 'Liability': '', 'Workers Compensation Insurance': '$1,000,000', 'Limit': '$1,000,000', 'Commercial General Liability Insurance': '$2,000,000', 'Technology Professional Liability Errors Omissions Policy': '$5,000,000', 'Excess Liability Umbrella Coverage': '$9,000,000', 'Client': 'Daltech, Inc.', 'Services Agreement Date': 'INITIAL STATEMENT  OF WORK (SOW)  The purpose of this SOW is to describe the Software and Services that Company will initially provide to  Daltech, Inc.  the “Client”) under the terms and conditions of the  Services Agreement  entered into between the parties on  June 15, 2021', 'Completion of the Services by Company Date': 'February 15, 2022', 'Charge': 'one hundred percent (100%)', 'Company': 'MagicSoft, Inc.', 'Effective Date': 'February 15, 2021', 'Start Date': '03/15/2021', 'Scheduled Onsite Visits Are Cancelled': 'ten (10) working days', 'Limit on Liability': '', 'Liability Cap': '', 'Business Automobile Liability': 'Business Automobile Liability  covering all vehicles that Company owns, hires or leases with a limit of no less than  $1,000,000  (combined single limit for bodily injury and property damage) for each accident.', 'Contractual Liability Coverage': 'Commercial General Liability insurance including  Contractual Liability Coverage , with coverage for products liability, completed operations, property damage and bodily injury, including  death , with an aggregate limit of no less than  $2,000,000 . This policy shall name Client as an additional insured with respect to the provision of services provided under this Agreement. This policy shall include a waiver of subrogation against Client.', 'Technology Professional Liability Errors Omissions': 'Technology Professional Liability Errors & Omissions policy (which includes Cyber Risk coverage and Computer Security and Privacy Liability coverage) with a limit of no less than  $5,000,000  per occurrence and in the aggregate.'}
page_content='2. Onsite Services.\n 2.1 Onsite visits will be charged on a <Frequency>daily </Frequency>basis (minimum <OnsiteVisits>8 hours</OnsiteVisits>).' metadata={'xpath': '/dg:chunk/docset:MASTERSERVICESAGREEMENT-section/docset:MASTERSERVICESAGREEMENT/dg:chunk[1]/docset:Standard/dg:chunk[3]/dg:chunk[1]', 'id': 'db18315b437ac2de6b555d2d8ef8f893', 'name': 'Master Services Agreement - Daltech.docx', 'source': 'Master Services Agreement - Daltech.docx', 'structure': 'lim h1 lim p', 'tag': 'chunk', 'Liability': '', 'Workers Compensation Insurance': '$1,000,000', 'Limit': '$1,000,000', 'Commercial General Liability Insurance': '$2,000,000', 'Technology Professional Liability Errors Omissions Policy': '$5,000,000', 'Excess Liability Umbrella Coverage': '$9,000,000', 'Client': 'Daltech, Inc.', 'Services Agreement Date': 'INITIAL STATEMENT  OF WORK (SOW)  The purpose of this SOW is to describe the Software and Services that Company will initially provide to  Daltech, Inc.  the “Client”) under the terms and conditions of the  Services Agreement  entered into between the parties on  June 15, 2021', 'Completion of the Services by Company Date': 'February 15, 2022', 'Charge': 'one hundred percent (100%)', 'Company': 'MagicSoft, Inc.', 'Effective Date': 'February 15, 2021', 'Start Date': '03/15/2021', 'Scheduled Onsite Visits Are Cancelled': 'ten (10) working days', 'Limit on Liability': '', 'Liability Cap': '', 'Business Automobile Liability': 'Business Automobile Liability  covering all vehicles that Company owns, hires or leases with a limit of no less than  $1,000,000  (combined single limit for bodily injury and property damage) for each accident.', 'Contractual Liability Coverage': 'Commercial General Liability insurance including  Contractual Liability Coverage , with coverage for products liability, completed operations, property damage and bodily injury, including  death , with an aggregate limit of no less than  $2,000,000 . This policy shall name Client as an additional insured with respect to the provision of services provided under this Agreement. This policy shall include a waiver of subrogation against Client.', 'Technology Professional Liability Errors Omissions': 'Technology Professional Liability Errors & Omissions policy (which includes Cyber Risk coverage and Computer Security and Privacy Liability coverage) with a limit of no less than  $5,000,000  per occurrence and in the aggregate.'}
page_content='2.2 <Expenses>Time and expenses will be charged based on actuals unless otherwise described in an Order Form or accompanying SOW. </Expenses>' metadata={'xpath': '/dg:chunk/docset:MASTERSERVICESAGREEMENT-section/docset:MASTERSERVICESAGREEMENT/dg:chunk[1]/docset:Standard/dg:chunk[3]/dg:chunk[2]/docset:ADailyBasis/dg:chunk[2]/dg:chunk', 'id': '506220fa472d5c48c8ee3db78c1122c1', 'name': 'Master Services Agreement - Daltech.docx', 'source': 'Master Services Agreement - Daltech.docx', 'structure': 'lim p', 'tag': 'chunk Expenses', 'Liability': '', 'Workers Compensation Insurance': '$1,000,000', 'Limit': '$1,000,000', 'Commercial General Liability Insurance': '$2,000,000', 'Technology Professional Liability Errors Omissions Policy': '$5,000,000', 'Excess Liability Umbrella Coverage': '$9,000,000', 'Client': 'Daltech, Inc.', 'Services Agreement Date': 'INITIAL STATEMENT  OF WORK (SOW)  The purpose of this SOW is to describe the Software and Services that Company will initially provide to  Daltech, Inc.  the “Client”) under the terms and conditions of the  Services Agreement  entered into between the parties on  June 15, 2021', 'Completion of the Services by Company Date': 'February 15, 2022', 'Charge': 'one hundred percent (100%)', 'Company': 'MagicSoft, Inc.', 'Effective Date': 'February 15, 2021', 'Start Date': '03/15/2021', 'Scheduled Onsite Visits Are Cancelled': 'ten (10) working days', 'Limit on Liability': '', 'Liability Cap': '', 'Business Automobile Liability': 'Business Automobile Liability  covering all vehicles that Company owns, hires or leases with a limit of no less than  $1,000,000  (combined single limit for bodily injury and property damage) for each accident.', 'Contractual Liability Coverage': 'Commercial General Liability insurance including  Contractual Liability Coverage , with coverage for products liability, completed operations, property damage and bodily injury, including  death , with an aggregate limit of no less than  $2,000,000 . This policy shall name Client as an additional insured with respect
