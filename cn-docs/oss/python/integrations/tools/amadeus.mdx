---
title: Amadeus 工具包
---
本笔记本将引导您如何将 LangChain 连接到 `Amadeus` 旅行 API。

这个 `Amadeus` 工具包允许智能体（agent）在旅行方面做出决策，特别是搜索和预订包含航班的行程。

要使用此工具包，您需要准备好您的 Amadeus API 密钥，具体说明请参阅 [Amadeus 自助服务 API 入门指南](https://developers.amadeus.com/get-started/get-started-with-self-service-apis-335)。一旦您获得了 AMADEUS_CLIENT_ID 和 AMADEUS_CLIENT_SECRET，就可以在下面将它们设置为环境变量。

注意：Amadeus 自助服务 API 提供了一个包含[免费有限数据](https://amadeus4dev.github.io/developer-guides/test-data/)的测试环境。这允许开发者在部署到生产环境之前构建和测试他们的应用程序。要访问实时数据，您需要[迁移到生产环境](https://amadeus4dev.github.io/developer-guides/API-Keys/moving-to-production/)。

```python
pip install -qU  amadeus > /dev/null
```

```python
pip install -qU langchain-community
```

## 设置环境变量

工具包将读取 AMADEUS_CLIENT_ID 和 AMADEUS_CLIENT_SECRET 环境变量来验证用户身份，因此您需要在此处设置它们。

```python
# 在此处设置环境变量
import os

os.environ["AMADEUS_CLIENT_ID"] = "CLIENT_ID"
os.environ["AMADEUS_CLIENT_SECRET"] = "CLIENT_SECRET"

# os.environ["AMADEUS_HOSTNAME"] = "production" or "test"
```

## 创建 Amadeus 工具包并获取工具

首先，您需要创建工具包，以便稍后访问其工具。

默认情况下，`AmadeusToolkit` 使用 @[`ChatOpenAI`] 来识别最接近给定位置的机场。要使用它，只需设置 `OPENAI_API_KEY`。

```python
os.environ["OPENAI_API_KEY"] = "YOUR_OPENAI_API_KEY"
```

```python
from langchain_community.agent_toolkits.amadeus.toolkit import AmadeusToolkit

toolkit = AmadeusToolkit()
tools = toolkit.get_tools()
```

或者，您也可以使用 langchain 支持的任何 LLM，例如 `HuggingFaceHub`。

```python
from langchain_community.llms import HuggingFaceHub

os.environ["HUGGINGFACEHUB_API_TOKEN"] = "YOUR_HF_API_TOKEN"

llm = HuggingFaceHub(
    repo_id="tiiuae/falcon-7b-instruct",
    model_kwargs={"temperature": 0.5, "max_length": 64},
)

toolkit_hf = AmadeusToolkit(llm=llm)
```

## 在智能体中使用 Amadeus 工具包

```python
from langchain_classic import hub
from langchain.agents import AgentExecutor, create_agent
from langchain.agents.output_parsers import ReActJsonSingleInputOutputParser
from langchain.tools.render import render_text_description_and_args
from langchain_openai import ChatOpenAI
```

```python
llm = ChatOpenAI(temperature=0)

prompt = hub.pull("hwchase17/react-json")
agent = create_agent(
    llm,
    tools,
    prompt,
    tools_renderer=render_text_description_and_args,
    output_parser=ReActJsonSingleInputOutputParser(),
)

agent_executor = AgentExecutor(
    agent=agent,
    tools=tools,
    verbose=True,
)
```

```python
agent_executor.invoke({"input": "What is the name of the airport in Cali, Colombia?"})
```

```text
> Entering new AgentExecutor chain...
I should use the closest_airport tool to find the airport in Cali, Colombia.
Action: closest_airport
Action Input: location= "Cali, Colombia"content='{\n  "iataCode": "CLO"\n}'The airport in Cali, Colombia is called CLO.
Final Answer: CLO

> Finished chain.
```

```text
{'input': 'What is the name of the airport in Cali, Colombia?',
 'output': 'CLO'}
```

```python
agent_executor.invoke(
    {
        "input": "What is the departure time of the cheapest flight on March 10, 2024 leaving Dallas, Texas before noon to Lincoln, Nebraska?"
    }
)
```

```text
> Entering new AgentExecutor chain...
Question: What is the departure time of the cheapest flight on March 10, 2024 leaving Dallas, Texas before noon to Lincoln, Nebraska?
Thought: We need to find the closest airport to Dallas, Texas, and then search for the cheapest flight departing before noon on March 10, 2024, to Lincoln, Nebraska.
Action:
\`\`\`
{
  "action": "closest_airport",
  "action_input": {
    "location": "Dallas, Texas"
  }
}
\`\`\`content='{\n    "iataCode": "DFW"\n}'Now, we have the IATA code for Dallas, Texas. Next, we will search for the cheapest flight departing before noon on March 10, 2024, from Dallas (DFW) to Lincoln, Nebraska.

Action:
\`\`\`
{
  "action": "single_flight_search",
  "action_input": {
    "originLocationCode": "DFW",
    "destinationLocationCode": "LNK",
    "departureDateTimeEarliest": "2024-03-10T00:00:00",
    "departureDateTimeLatest": "2024-03-10T12:00:00"
  }
}
\`\`\`[{'price': {'total': '593.35', 'currency': 'EURO'}, 'segments': [{'departure': {'iataCode': 'DFW', 'terminal': 'E', 'at': '2024-03-10T10:54:00'}, 'arrival': {'iataCode': 'ORD', 'terminal': '1', 'at': '2024-03-10T13:15:00'}, 'flightNumber': '1634', 'carrier': 'UNITED AIRLINES'}, {'departure': {'iataCode': 'ORD', 'terminal': '2', 'at': '2024-03-11T12:45:00'}, 'arrival': {'iataCode': 'LNK', 'at': '2024-03-11T14:19:00'}, 'flightNumber': '5728', 'carrier': 'UNITED AIRLINES'}]}, {'price': {'total': '652.68', 'currency': 'EURO'}, 'segments': [{'departure': {'iataCode': 'DFW', 'terminal': 'E', 'at': '2024-03-10T07:25:00'}, 'arrival': {'iataCode': 'ORD', 'terminal': '1', 'at': '2024-03-10T09:46:00'}, 'flightNumber': '380', 'carrier': 'UNITED AIRLINES'}, {'departure': {'iataCode': 'ORD', 'terminal': '2', 'at': '2024-03-10T12:45:00'}, 'arrival': {'iataCode': 'LNK', 'at': '2024-03-10T14:19:00'}, 'flightNumber': '5728', 'carrier': 'UNITED AIRLINES'}]}, {'price': {'total': '765.35', 'currency': 'EURO'}, 'segments': [{'departure': {'iataCode': 'DFW', 'terminal': 'E', 'at': '2024-03-10T16:42:00'}, 'arrival': {'iataCode': 'DEN', 'at': '2024-03-10T17:49:00'}, 'flightNumber': '2655', 'carrier': 'UNITED AIRLINES'}, {'departure': {'iataCode': 'DEN', 'at': '2024-03-11T17:45:00'}, 'arrival': {'iataCode': 'LNK', 'at': '2024-03-11T20:07:00'}, 'flightNumber': '4910', 'carrier': 'UNITED AIRLINES'}]}, {'price': {'total': '810.82', 'currency': 'EURO'}, 'segments': [{'departure': {'iataCode': 'DFW', 'terminal': 'E', 'at': '2024-03-10T12:35:00'}, 'arrival': {'iataCode': 'IAD', 'at': '2024-03-10T16:20:00'}, 'flightNumber': '358', 'carrier': 'UNITED AIRLINES'}, {'departure': {'iataCode': 'DCA', 'terminal': '2', 'at': '2024-03-11T07:45:00'}, 'arrival': {'iataCode': 'ORD', 'terminal': '2', 'at': '2024-03-11T08:51:00'}, 'flightNumber': '4645', 'carrier': 'UNITED AIRLINES'}, {'departure': {'iataCode': 'ORD', 'terminal': '2', 'at': '2024-03-11T12:45:00'}, 'arrival': {'iataCode': 'LNK', 'at': '2024-03-11T14:19:00'}, 'flightNumber': '5728', 'carrier': 'UNITED AIRLINES'}]}, {'price': {'total': '810.82', 'currency': 'EURO'}, 'segments': [{'departure': {'iataCode': 'DFW', 'terminal': 'E', 'at': '2024-03-10T12:35:00'}, 'arrival': {'iataCode': 'IAD', 'at': '2024-03-10T16:20:00'}, 'flightNumber': '358', 'carrier': 'UNITED AIRLINES'}, {'departure': {'iataCode': 'DCA', 'terminal': '2', 'at': '2024-03-11T09:45:00'}, 'arrival': {'iataCode': 'ORD', 'terminal': '2', 'at': '2024-03-11T10:42:00'}, 'flightNumber': '5215', 'carrier': 'UNITED AIRLINES'}, {'departure': {'iataCode': 'ORD', 'terminal': '2', 'at': '2024-03-11T12:45:00'}, 'arrival': {'iataCode': 'LNK', 'at': '2024-03-11T14:19:00'}, 'flightNumber': '5728', 'carrier': 'UNITED AIRLINES'}]}, {'price': {'total': '815.99', 'currency': 'EURO'}, 'segments': [{'departure': {'iataCode': 'DFW', 'terminal': 'E', 'at': '2024-03-10T12:35:00'}, 'arrival': {'iataCode': 'IAD', 'at': '2024-03-10T16:20:00'}, 'flightNumber': '358', 'carrier': 'UNITED AIRLINES'}, {'departure': {'iataCode': 'IAD', 'at': '2024-03-11T07:00:00'}, 'arrival': {'iataCode': 'ORD', 'terminal': '1', 'at': '2024-03-11T08:03:00'}, 'flightNumber': '418', 'carrier': 'UNITED AIRLINES'}, {'departure': {'iataCode': 'ORD', 'terminal': '2', 'at': '2024-03-11T12:45:00'}, 'arrival': {'iataCode': 'LNK', 'at': '2024-03-11T14:19:00'}, 'flightNumber': '5728', 'carrier': 'UNITED AIRLINES'}]}, {'price': {'total': '901.12', 'currency': 'EURO'}, 'segments': [{'departure': {'iataCode': 'DFW', 'terminal': 'E', 'at': '2024-03-10T06:00:00'}, 'arrival': {'iataCode': 'EWR', 'terminal': 'C', 'at': '2024-03-10T10:25:00'}, 'flightNumber': '1517', 'carrier': 'UNITED AIRLINES'}, {'departure': {'iataCode': 'EWR', 'terminal': 'C', 'at': '2024-03-10T13:15:00'}, 'arrival': {'iataCode': 'ORD', 'terminal': '1', 'at': '2024-03-10T14:50:00'}, 'flightNumber': '323', 'carrier': 'UNITED AIRLINES'}, {'departure': {'iataCode': 'ORD', 'terminal': '2', 'at': '2024-03-10T19:35:00'}, 'arrival': {'iataCode': 'LNK', 'at': '2024-03-10T21:19:00'}, 'flightNumber': '5413', 'carrier': 'UNITED AIRLINES'}]}, {'price': {'total': '901.12', 'currency': 'EURO'}, 'segments': [{'departure': {'iataCode': 'DFW', 'terminal': 'E', 'at': '2024-03-10T06:00:00'}, 'arrival': {'iataCode': 'EWR', 'terminal': 'C', 'at': '2024-03-10T10:25:00'}, 'flightNumber': '1517', 'carrier': 'UNITED AIRLINES'}, {'departure': {'iataCode': 'EWR', 'terminal': 'C', 'at': '2024-03-10T11:40:00'}, 'arrival': {'iataCode': 'ORD', 'terminal': '1', 'at': '2024-03-10T13:23:00'}, 'flightNumber': '1027', 'carrier': 'UNITED AIRLINES'}, {'departure': {'iataCode': 'ORD', 'terminal': '2', 'at': '2024-03-10T19:35:00'}, 'arrival': {'iataCode': 'LNK', 'at': '2024-03-10T21:19:00'}, 'flightNumber': '5413', 'carrier': 'UNITED AIRLINES'}]}, {'price': {'total': '919.40', 'currency': 'EURO'}, 'segments': [{'departure': {'iataCode': 'DFW', 'terminal': 'E', 'at': '2024-03-10T06:00:00'}, 'arrival': {'iataCode': 'EWR', 'terminal': 'C', 'at': '2024-03-10T10:25:00'}, 'flightNumber': '1517', 'carrier': 'UNITED AIRLINES'}, {'departure': {'iataCode': 'EWR', 'terminal': 'C', 'at': '2024-03-10T15:10:00'}, 'arrival': {'iataCode': 'ORD', 'terminal': '1', 'at': '2024-03-10T16:57:00'}, 'flightNumber': '1504', 'carrier': 'UNITED AIRLINES'}, {'departure': {'iataCode': 'ORD', 'terminal': '2', 'at': '2024-03-10T19:35:00'}, 'arrival': {'iataCode': 'LNK', 'at': '2024-03-10T21:19:00'}, 'flightNumber': '5413', 'carrier': 'UNITED AIRLINES'}]}, {'price': {'total': '963.36', 'currency': 'EURO'}, 'segments': [{'departure': {'iataCode': 'DFW', 'terminal': 'E', 'at': '2024-03-10T13:45:00'}, 'arrival': {'iataCode': 'DEN', 'at': '2024-03-10T14:45:00'}, 'flightNumber': '1380', 'carrier': 'UNITED AIRLINES'}, {'departure': {'iataCode': 'DEN', 'at': '2024-03-10T17:45:00'}, 'arrival': {'iataCode': 'LNK', 'at': '2024-03-10T20:07:00'}, 'flightNumber': '4910', 'carrier': 'UNITED AIRLINES'}]}]Observation: The cheapest flight on March 10, 2024, from Dallas, Texas (DFW) to Lincoln, Nebraska (LNK) departs at 10:54 AM.
Final Answer: The departure time of the cheapest flight on March 10, 2024, leaving Dallas, Texas before noon to Lincoln, Nebraska is 10:54 AM.

> Finished chain.
```

```text
{'input': 'What is the departure time of the cheapest flight on March 10, 2024 leaving Dallas, Texas before noon to Lincoln, Nebraska?',
 'output': 'The departure time of the cheapest flight on March 10, 2024, leaving Dallas, Texas before noon to Lincoln, Nebraska is 10:54 AM.'}
```

```python
agent_executor.invoke(
    {
        "input": "At what time does earliest flight on March 10, 2024 leaving Dallas, Texas to Lincoln, Nebraska land in Nebraska?"
    }
)
```

```text
> Entering new AgentExecutor chain...
Question: At what time does the earliest flight on March 10, 2024, leaving Dallas, Texas,
