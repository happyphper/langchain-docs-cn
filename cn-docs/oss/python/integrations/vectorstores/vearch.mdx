---
title: Vearch
---
>[Vearch](https://vearch.readthedocs.io) æ˜¯é¢å‘æ·±åº¦å­¦ä¹ å’Œ AI åº”ç”¨çš„å‘é‡æœç´¢åŸºç¡€è®¾æ–½ã€‚

## ç¯å¢ƒè®¾ç½®

è¯·æŒ‰ç…§[è¯´æ˜](https://vearch.readthedocs.io/en/latest/quick-start-guide.html#)è¿›è¡Œæ“ä½œã€‚

ä½ éœ€è¦å®‰è£… `langchain-community` åŒ…æ‰èƒ½ä½¿ç”¨æ­¤é›†æˆï¼Œä½¿ç”¨å‘½ä»¤ `pip install -qU langchain-community`

```python
pip install -qU  vearch

# æˆ–è€…

pip install -qU  vearch_cluster
```

## ç¤ºä¾‹

```python
from langchain_community.document_loaders import TextLoader
from langchain_community.vectorstores.vearch import Vearch
from langchain_huggingface import HuggingFaceEmbeddings
from langchain_text_splitters import RecursiveCharacterTextSplitter
from transformers import AutoModel, AutoTokenizer

# æ›¿æ¢ä¸ºä½ çš„æœ¬åœ°æ¨¡å‹è·¯å¾„
model_path = "/data/zhx/zhx/langchain-ChatGLM_new/chatglm2-6b"

tokenizer = AutoTokenizer.from_pretrained(model_path, trust_remote_code=True)
model = AutoModel.from_pretrained(model_path, trust_remote_code=True).half().cuda(0)
```

```text
Loading checkpoint shards: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 7/7 [00:07<00:00,  1.01s/it]
```

```python
query = "ä½ å¥½!"
response, history = model.chat(tokenizer, query, history=[])
print(f"Human: {query}\nChatGLM:{response}\n")
query = "ä½ çŸ¥é“å‡Œæ³¢å¾®æ­¥å—ï¼Œä½ çŸ¥é“éƒ½æœ‰è°å­¦ä¼šäº†å—?"
response, history = model.chat(tokenizer, query, history=history)
print(f"Human: {query}\nChatGLM:{response}\n")
```

```text
Human: ä½ å¥½!
ChatGLM:ä½ å¥½ğŸ‘‹ï¼æˆ‘æ˜¯äººå·¥æ™ºèƒ½åŠ©æ‰‹ ChatGLM2-6Bï¼Œå¾ˆé«˜å…´è§åˆ°ä½ ï¼Œæ¬¢è¿é—®æˆ‘ä»»ä½•é—®é¢˜ã€‚

Human: ä½ çŸ¥é“å‡Œæ³¢å¾®æ­¥å—ï¼Œä½ çŸ¥é“éƒ½æœ‰è°å­¦ä¼šäº†å—?
ChatGLM:å‡Œæ³¢å¾®æ­¥æ˜¯ä¸€ç§æ­¥ä¼ï¼Œæœ€æ—©å‡ºè‡ªã€Šå€šå¤©å± é¾™è®°ã€‹ã€‚åœ¨ç”µè§†å‰§ã€Šäººæ°‘çš„åä¹‰ã€‹ä¸­ï¼Œä¾¯äº®å¹³ä¹Ÿå­¦ä¼šäº†å‡Œæ³¢å¾®æ­¥ã€‚
```

```python
# æ·»åŠ ä½ çš„æœ¬åœ°çŸ¥è¯†æ–‡ä»¶
file_path = "/data/zhx/zhx/langchain-ChatGLM_new/knowledge_base/å¤©é¾™å…«éƒ¨/lingboweibu.txt"  # ä½ çš„æœ¬åœ°æ–‡ä»¶è·¯å¾„"
loader = TextLoader(file_path, encoding="utf-8")
documents = loader.load()

# å°†æ–‡æœ¬åˆ†å‰²æˆå¥å­å¹¶å¯¹å¥å­è¿›è¡ŒåµŒå…¥
text_splitter = RecursiveCharacterTextSplitter(chunk_size=500, chunk_overlap=100)
texts = text_splitter.split_documents(documents)

# æ›¿æ¢ä¸ºä½ çš„æ¨¡å‹è·¯å¾„
embedding_path = "/data/zhx/zhx/langchain-ChatGLM_new/text2vec/text2vec-large-chinese"
embeddings = HuggingFaceEmbeddings(model_name=embedding_path)
```

```text
No sentence-transformers model found with name /data/zhx/zhx/langchain-ChatGLM_new/text2vec/text2vec-large-chinese. Creating a new one with MEAN pooling.
```

```python
# é¦–å…ˆå°†ä½ çš„æ–‡æ¡£æ·»åŠ åˆ° vearch å‘é‡å­˜å‚¨ä¸­
vearch_standalone = Vearch.from_documents(
    texts,
    embeddings,
    path_or_url="/data/zhx/zhx/langchain-ChatGLM_new/knowledge_base/localdb_new_test",
    table_name="localdb_new_test",
    flag=0,
)

print("***************after is cluster res*****************")

vearch_cluster = Vearch.from_documents(
    texts,
    embeddings,
    path_or_url="http://test-vearch-langchain-router.vectorbase.svc.ht1.n.jd.local",
    db_name="vearch_cluster_langchian",
    table_name="tobenumone",
    flag=1,
)

# å‘é‡æ•°æ®é€šå¸¸å·²ç»åˆå§‹åŒ–ï¼Œå› æ­¤æˆ‘ä»¬ä¸éœ€è¦æ–‡æ¡£å‚æ•°ï¼Œå¯ä»¥ç›´æ¥åˆ›å»ºå¯¹è±¡ã€‚
vearch_cluster_b = Vearch(
    embeddings,
    path_or_url="http://test-vearch-langchain-router.vectorbase.svc.ht1.n.jd.local",
    db_name="vearch_cluster_langchian",
    table_name="tobenumone",
    flag=1,
)
```

```text
docids ['18ce6747dca04a2c833e60e8dfd83c04', 'aafacb0e46574b378a9f433877ab06a8', '9776bccfdd8643a8b219ccee0596f370']
***************after is cluster res*****************
docids ['1841638988191686991', '-4519586577642625749', '5028230008472292907']
```

```python
query = "ä½ çŸ¥é“å‡Œæ³¢å¾®æ­¥å—ï¼Œä½ çŸ¥é“éƒ½æœ‰è°ä¼šå‡Œæ³¢å¾®æ­¥?"
# ç¬¬äºŒä¸ªå‚æ•°æ˜¯è¦æ£€ç´¢çš„ top-n æ•°é‡ï¼Œå…¶é»˜è®¤å€¼ä¸º 4ã€‚
vearch_standalone_res = vearch_standalone.similarity_search(query, 3)
for idx, tmp in enumerate(vearch_standalone_res):
    print(f"{'#' * 20}ç¬¬{idx + 1}æ®µç›¸å…³æ–‡æ¡£{'#' * 20}\n\n{tmp.page_content}\n")

# ç»“åˆä½ çš„æœ¬åœ°çŸ¥è¯†å’ŒæŸ¥è¯¢
context = "".join([tmp.page_content for tmp in vearch_standalone_res])
new_query = f"åŸºäºä»¥ä¸‹ä¿¡æ¯ï¼Œå°½å¯èƒ½å‡†ç¡®çš„æ¥å›ç­”ç”¨æˆ·çš„é—®é¢˜ã€‚èƒŒæ™¯ä¿¡æ¯:\n {context} \n å›ç­”ç”¨æˆ·è¿™ä¸ªé—®é¢˜:{query}\n\n"
response, history = model.chat(tokenizer, new_query, history=[])
print(f"********ChatGLM:{response}\n")

print("***************************after is cluster res******************************")

query_c = "ä½ çŸ¥é“å‡Œæ³¢å¾®æ­¥å—ï¼Œä½ çŸ¥é“éƒ½æœ‰è°ä¼šå‡Œæ³¢å¾®æ­¥?"
cluster_res = vearch_cluster.similarity_search(query_c, 3)
for idx, tmp in enumerate(cluster_res):
    print(f"{'#' * 20}ç¬¬{idx + 1}æ®µç›¸å…³æ–‡æ¡£{'#' * 20}\n\n{tmp.page_content}\n")

# åœ¨å®é™…åº”ç”¨ä¸­ï¼Œæˆ‘ä»¬é€šå¸¸é™åˆ¶ç›¸ä¼¼åº¦çš„è¾¹ç•Œå€¼ã€‚ä»¥ä¸‹æ–¹æ³•å¯ä»¥è®¾ç½®æ­¤å€¼ã€‚
cluster_res_with_bound = vearch_cluster.similarity_search_with_score(
    query=query_c, k=3, min_score=0.5
)

# ç»“åˆä½ çš„æœ¬åœ°çŸ¥è¯†å’ŒæŸ¥è¯¢
context_c = "".join([tmp.page_content for tmp in cluster_res])
new_query_c = f"åŸºäºä»¥ä¸‹ä¿¡æ¯ï¼Œå°½å¯èƒ½å‡†ç¡®çš„æ¥å›ç­”ç”¨æˆ·çš„é—®é¢˜ã€‚èƒŒæ™¯ä¿¡æ¯:\n {context_c} \n å›ç­”ç”¨æˆ·è¿™ä¸ªé—®é¢˜:{query_c}\n\n"
response_c, history_c = model.chat(tokenizer, new_query_c, history=[])
print(f"********ChatGLM:{response_c}\n")
```

```text
####################ç¬¬1æ®µç›¸å…³æ–‡æ¡£####################

åˆé¥­è¿‡åï¼Œæ®µèª‰åˆç»ƒâ€œå‡Œæ³¢å¾®æ­¥â€ï¼Œèµ°ä¸€æ­¥ï¼Œå¸ä¸€å£æ°”ï¼Œèµ°ç¬¬äºŒæ­¥æ—¶å°†æ°”å‘¼å‡ºï¼Œå…­åå››å¦èµ°å®Œï¼Œå››è‚¢å…¨æ— éº»ç—¹ä¹‹æ„Ÿï¼Œæ–™æƒ³å‘¼å¸é¡ºç•…ï¼Œä¾¿æ— å®³å¤„ã€‚ç¬¬äºŒæ¬¡å†èµ°æ—¶è¿èµ°ä¸¤æ­¥å¸ä¸€å£æ°”ï¼Œå†èµ°ä¸¤æ­¥å§‹è¡Œå‘¼å‡ºã€‚è¿™â€œå‡Œæ³¢å¾®æ­¥â€æ˜¯ä»¥åŠ¨åŠŸä¿®ä¹ å†…åŠŸï¼Œè„šæ­¥è¸éå…­åå››å¦ä¸€ä¸ªå‘¨å¤©ï¼Œå†…æ¯è‡ªç„¶è€Œç„¶åœ°ä¹Ÿè½¬äº†ä¸€ä¸ªå‘¨å¤©ã€‚å› æ­¤ä»–æ¯èµ°ä¸€éï¼Œå†…åŠ›ä¾¿æœ‰ä¸€åˆ†è¿›ç›Šã€‚

è¿™èˆ¬ç»ƒäº†å‡ å¤©ï¼Œâ€œå‡Œæ³¢å¾®æ­¥â€å·²èµ°å¾—é¢‡ä¸ºçº¯ç†Ÿï¼Œä¸é¡»å†æ•°å‘¼å¸ï¼Œçºµç„¶ç–¾è¡Œï¼Œæ°”æ¯ä¹Ÿå·²æ— æ‰€çª’æ»ã€‚å¿ƒæ„æ—¢ç•…ï¼Œè·¨æ­¥æ—¶æ¸æ¸æƒ³åˆ°ã€Šæ´›ç¥èµ‹ã€‹ä¸­é‚£äº›ä¸â€œå‡Œæ³¢å¾®æ­¥â€æœ‰å…³çš„å¥å­ï¼šâ€œä»¿ä½›å…®è‹¥è½»äº‘ä¹‹è”½æœˆï¼Œé£˜é£˜å…®è‹¥æµé£ä¹‹å›é›ªâ€ï¼Œâ€œç«¦è½»èº¯ä»¥é¹¤ç«‹ï¼Œè‹¥å°†é£è€Œæœªç¿”â€ï¼Œâ€œä½“è¿…é£å‡«ï¼Œé£˜å¿½è‹¥ç¥â€ï¼Œâ€œåŠ¨æ— å¸¸åˆ™ï¼Œè‹¥å±è‹¥å®‰ã€‚è¿›æ­¢éš¾æœŸï¼Œè‹¥å¾€è‹¥è¿˜â€ã€‚



ç™¾åº¦ç®€ä»‹

å‡Œæ³¢å¾®æ­¥æ˜¯ã€Œé€é¥æ´¾ã€ç‹¬é—¨è½»åŠŸèº«æ³•ï¼Œç²¾å¦™å¼‚å¸¸ã€‚

å‡Œæ³¢å¾®æ­¥ä¹ƒæ˜¯ä¸€é—¨æä¸Šä¹˜çš„è½»åŠŸï¼Œæ‰€ä»¥åˆ—äºå·è½´ä¹‹æœ«ï¼Œä»¥æ˜“ç»å…«å…«å…­åå››å¦ä¸ºåŸºç¡€ï¼Œä½¿ç”¨è€…æŒ‰ç‰¹å®šé¡ºåºè¸ç€å¦è±¡æ–¹ä½è¡Œè¿›ï¼Œä»ç¬¬ä¸€æ­¥åˆ°æœ€åä¸€æ­¥æ­£å¥½è¡Œèµ°ä¸€ä¸ªå¤§åœˆã€‚æ­¤æ­¥æ³•ç²¾å¦™å¼‚å¸¸ï¼ŒåŸæ˜¯è¦å¾…äººç»ƒæˆã€ŒåŒ—å†¥ç¥åŠŸã€ï¼Œå¸äººå†…åŠ›ï¼Œè‡ªèº«å†…åŠ›å·²ã€é¢‡ä¸ºæ·±åšã€‘ä¹‹åå†ç»ƒã€‚

####################ç¬¬2æ®µç›¸å…³æ–‡æ¡£####################

ã€Šå¤©é¾™å…«éƒ¨ã€‹ç¬¬äº”å› å¾®æ­¥ç¸ çº¹ç”Ÿ

å·è½´ä¸­æ­¤å¤–è¯¸ç§ç»è„‰ä¿®ä¹ ä¹‹æ³•ç”šå¤šï¼Œçš†æ˜¯å–äººå†…åŠ›çš„æ³•é—¨ï¼Œæ®µèª‰è™½è‡ªè¯­å®½è§£ï¼Œæ€»è§‰ä¹ ä¹‹æœ‰è¿æœ¬æ€§ï¼Œå•æ˜¯è´ªå¤šåŠ¡å¾—ï¼Œä¾¿éå¥½äº‹ï¼Œå½“ä¸‹æš‚ä¸ç†ä¼šã€‚

å·åˆ°å·è½´æœ«ç«¯ï¼Œåˆè§åˆ°äº†â€œå‡Œæ³¢å¾®æ­¥â€é‚£å››å­—ï¼Œç™»æ—¶ä¾¿æƒ³èµ·ã€Šæ´›ç¥èµ‹ã€‹ä¸­é‚£äº›å¥å­æ¥ï¼šâ€œå‡Œæ³¢å¾®æ­¥ï¼Œç½—è¢œç”Ÿå°˜â€¦â€¦è½¬çœ„æµç²¾ï¼Œå…‰æ¶¦ç‰é¢œã€‚å«è¾æœªåï¼Œæ°”è‹¥å¹½å…°ã€‚åå®¹å©€å¨œï¼Œä»¤æˆ‘å¿˜é¤ã€‚â€æ›¹å­å»ºé‚£äº›åƒå¤åå¥ï¼Œåœ¨è„‘æµ·ä¸­ç¼“ç¼“æµè¿‡ï¼šâ€œç§¾çº¤å¾—è¡·ï¼Œä¿®çŸ­åˆåº¦ï¼Œè‚©è‹¥å‰Šæˆï¼Œè…°å¦‚çº¦ç´ ã€‚å»¶é¢ˆç§€é¡¹ï¼Œçš“è´¨å‘ˆéœ²ã€‚èŠ³æ³½æ— åŠ ï¼Œé“…åå¼—å¾¡ã€‚äº‘é«»å³¨å³¨ï¼Œä¿®çœ‰è¿å¨Ÿã€‚ä¸¹å”‡å¤–æœ—ï¼Œçš“é½¿å†…é²œã€‚æ˜çœ¸å–„çï¼Œé¥è¾…æ‰¿æƒã€‚ç‘°å§¿è‰³é€¸ï¼Œä»ªé™ä½“é—²ã€‚æŸ”æƒ…ç»°æ€ï¼Œåªšäºè¯­è¨€â€¦â€¦â€è¿™äº›å¥å­ç”¨åœ¨æœ¨å©‰æ¸…èº«ä¸Šï¼Œâ€œè¿™è¯å€’ä¹Ÿæœ‰ç†â€ï¼›ä½†å¦‚ç”¨ä¹‹äºç¥ä»™å§Šå§Šï¼Œåªæ€•æ›´ä¸ºé€‚åˆã€‚æƒ³åˆ°ç¥ä»™å§Šå§Šçš„å§¿å®¹ä½“æ€ï¼Œâ€œçšè‹¥å¤ªé˜³å‡æœéœï¼Œç¼è‹¥èŠ™è“‰å‡ºç»¿æ³¢â€ï¼Œä½†è§‰ä¾å¥¹å©å’è¡Œäº‹ï¼Œå®ä¸ºäººç”Ÿè‡³ä¹ï¼Œå¿ƒæƒ³ï¼šâ€œæˆ‘å…ˆæ¥ç»ƒè¿™â€˜å‡Œæ³¢å¾®æ­¥â€™ï¼Œæ­¤ä¹ƒé€ƒå‘½ä¹‹å¦™æ³•ï¼Œéå®³äººä¹‹æ‰‹æ®µä¹Ÿï¼Œç»ƒä¹‹æœ‰ç™¾åˆ©è€Œæ— ä¸€å®³ã€‚â€

####################ç¬¬3æ®µç›¸å…³æ–‡æ¡£####################

ã€Šå¤©é¾™å…«éƒ¨ã€‹ç¬¬äºŒå› ç‰å£æœˆåæ˜

å†å±•å¸›å·ï¼Œé•¿å·ä¸Šæºæºçš†æ˜¯è£¸å¥³ç”»åƒï¼Œæˆ–ç«‹æˆ–å§ï¼Œæˆ–ç°å‰èƒ¸ï¼Œæˆ–è§åèƒŒã€‚äººåƒçš„é¢å®¹éƒ½æ˜¯ä¸€èˆ¬ï¼Œä½†æˆ–å–œæˆ–æ„ï¼Œæˆ–å«æƒ…å‡çœ¸ï¼Œæˆ–è½»å—”è–„æ€’ï¼Œç¥æƒ…å„å¼‚ã€‚ä¸€å…±æœ‰ä¸‰åå…­å¹…å›¾åƒï¼Œæ¯å¹…åƒä¸Šå‡æœ‰é¢œè‰²ç»†çº¿ï¼Œæ³¨æ˜ç©´é“éƒ¨ä½åŠç»ƒåŠŸæ³•è¯€ã€‚

å¸›å·å°½å¤„é¢˜ç€â€œå‡Œæ³¢å¾®æ­¥â€å››å­—ï¼Œå…¶åç»˜çš„æ˜¯æ— æ•°è¶³å°ï¼Œæ³¨æ˜â€œå¦‡å¦¹â€ã€â€œæ— å¦„â€ç­‰ç­‰å­—æ ·ï¼Œå°½æ˜¯ã€Šæ˜“ç»ã€‹ä¸­çš„æ–¹ä½ã€‚æ®µèª‰å‰å‡ æ—¥è¿˜æ­£å…¨å¿ƒå…¨æ„åœ°é’»ç ”ã€Šæ˜“ç»ã€‹ï¼Œä¸€è§åˆ°è¿™äº›åç§°ï¼Œç™»æ—¶ç²¾ç¥å¤§æŒ¯ï¼Œä¾¿ä¼¼é‡åˆ°æ•…äº¤è‰¯å‹ä¸€èˆ¬ã€‚åªè§è¶³å°å¯†å¯†éº»éº»ï¼Œä¸çŸ¥æœ‰å‡ åƒç™¾ä¸ªï¼Œè‡ªä¸€ä¸ªè¶³å°è‡³å¦ä¸€ä¸ªè¶³å°å‡æœ‰ç»¿çº¿è´¯ä¸²ï¼Œçº¿ä¸Šç»˜æœ‰ç®­å¤´ï¼Œæœ€åå†™ç€ä¸€è¡Œå­—é“ï¼šâ€œæ­¥æ³•ç¥å¦™ï¼Œä¿èº«é¿æ•Œï¼Œå¾…ç§¯å†…åŠ›ï¼Œå†å–æ•Œå‘½ã€‚â€

æ®µèª‰å¿ƒé“ï¼šâ€œç¥ä»™å§Šå§Šæ‰€é—çš„æ­¥æ³•ï¼Œå¿…å®šç²¾å¦™ä¹‹æï¼Œé‡åˆ°å¼ºæ•Œæ—¶è„±èº«é€ƒèµ°ï¼Œé‚£å°±å¾ˆå¥½ï¼Œâ€˜å†å–æ•Œå‘½â€™ä¹Ÿå°±ä¸å¿…äº†ã€‚â€
å·å¥½å¸›å·ï¼Œå¯¹ä¹‹ä½œäº†ä¸¤ä¸ªæ–ï¼Œçè€Œé‡ä¹‹åœ°æ£å…¥æ€€ä¸­ï¼Œè½¬èº«å¯¹é‚£ç‰åƒé“ï¼šâ€œç¥ä»™å§Šå§Šï¼Œä½ å©å’æˆ‘æœåˆæ™šä¸‰æ¬¡ç»ƒåŠŸï¼Œæ®µèª‰ä¸æ•¢æœ‰è¿ã€‚ä»Šåæˆ‘å¯¹äººåŠ å€å®¢æ°”ï¼Œåˆ«äººä¸ä¼šæ¥æ‰“æˆ‘ï¼Œæˆ‘è‡ªç„¶ä¹Ÿä¸ä¼šå»å¸ä»–å†…åŠ›ã€‚ä½ è¿™å¥—â€˜å‡Œæ³¢å¾®æ­¥â€™æˆ‘æ›´è¦ç”¨å¿ƒç»ƒç†Ÿï¼Œçœ¼è§ä¸å¯¹ï¼Œç«‹åˆ»æºœä¹‹å¤§å‰ï¼Œå°±å¸ä¸åˆ°ä»–å†…åŠ›äº†ã€‚â€è‡³äºâ€œæ€å°½æˆ‘é€é¥æ´¾å¼Ÿå­â€ä¸€èŠ‚ï¼Œå´æƒ³ä¹Ÿä¸æ•¢å»æƒ³ã€‚

********ChatGLM:å‡Œæ³¢å¾®æ­¥æ˜¯ä¸€é—¨æä¸Šä¹˜çš„è½»åŠŸï¼Œæºäºã€Šæ˜“ç»ã€‹å…«å…«å…­åå››å¦ã€‚ä½¿ç”¨è€…æŒ‰ç…§ç‰¹å®šé¡ºåºè¸ç€å¦è±¡æ–¹ä½è¡Œè¿›ï¼Œä»ç¬¬ä¸€æ­¥åˆ°æœ€åä¸€æ­¥æ­£å¥½è¡Œèµ°ä¸€ä¸ªå¤§åœˆã€‚è¿™é—¨è½»åŠŸç²¾å¦™å¼‚å¸¸ï¼Œå¯ä»¥ä½¿äººå†…åŠ›å¤§ä¸ºæå‡ï¼Œä½†éœ€åœ¨ç»ƒæˆâ€œåŒ—å†¥ç¥åŠŸâ€åæ‰èƒ½çœŸæ­£æŒæ¡ã€‚å‡Œæ³¢å¾®æ­¥åœ¨é‡‘åº¸å…ˆç”Ÿçš„ã€Šå¤©é¾™å…«éƒ¨ã€‹ä¸­å¾—åˆ°äº†å……åˆ†çš„æå†™ã€‚

***************************after is cluster res******************************
####################ç¬¬1æ®µç›¸å…³æ–‡æ¡£####################

åˆé¥­è¿‡åï¼Œæ®µèª‰åˆç»ƒâ€œå‡Œæ³¢å¾®æ­¥â€ï¼Œèµ°ä¸€æ­¥ï¼Œå¸ä¸€å£æ°”ï¼Œèµ°ç¬¬äºŒæ­¥æ—¶å°†æ°”å‘¼å‡ºï¼Œå…­åå››å¦èµ°å®Œï¼Œå››è‚¢å…¨æ— éº»ç—¹ä¹‹æ„Ÿï¼Œæ–™æƒ³å‘¼å¸é¡ºç•…ï¼Œä¾¿æ— å®³å¤„ã€‚ç¬¬äºŒæ¬¡å†èµ°æ—¶è¿èµ°ä¸¤æ­¥å¸ä¸€å£æ°”ï¼Œå†èµ°ä¸¤æ­¥å§‹è¡Œå‘¼å‡ºã€‚è¿™â€œå‡Œæ³¢å¾®æ­¥â€æ˜¯ä»¥åŠ¨åŠŸä¿®ä¹ å†…åŠŸï¼Œè„šæ­¥è¸éå…­åå››å¦ä¸€ä¸ªå‘¨å¤©ï¼Œå†…æ¯è‡ªç„¶è€Œç„¶åœ°ä¹Ÿè½¬äº†ä¸€ä¸ªå‘¨å¤©ã€‚å› æ­¤ä»–æ¯èµ°ä¸€éï¼Œå†…åŠ›ä¾¿æœ‰ä¸€åˆ†è¿›ç›Šã€‚

è¿™èˆ¬ç»ƒäº†å‡ å¤©ï¼Œâ€œå‡Œæ³¢å¾®æ­¥â€å·²èµ°å¾—é¢‡ä¸ºçº¯ç†Ÿï¼Œä¸é¡»å†æ•°å‘¼å¸ï¼Œçºµç„¶ç–¾è¡Œï¼Œæ°”æ¯ä¹Ÿå·²æ— æ‰€çª’æ»ã€‚å¿ƒæ„æ—¢ç•…ï¼Œè·¨æ­¥æ—¶æ¸æ¸æƒ³åˆ°ã€Šæ´›ç¥èµ‹ã€‹ä¸­é‚£äº›ä¸â€œå‡Œæ³¢å¾®æ­¥â€æœ‰å…³çš„å¥å­ï¼šâ€œä»¿ä½›å…®è‹¥è½»äº‘ä¹‹è”½æœˆï¼Œé£˜é£˜å…®è‹¥æµé£ä¹‹å›é›ªâ€ï¼Œâ€œç«¦è½»èº¯ä»¥é¹¤ç«‹ï¼Œè‹¥å°†é£è€Œæœªç¿”â€ï¼Œâ€œä½“è¿…é£å‡«ï¼Œé£˜å¿½è‹¥ç¥â€ï¼Œâ€œåŠ¨æ— å¸¸åˆ™ï¼Œè‹¥å±è‹¥å®‰ã€‚è¿›æ­¢éš¾æœŸï¼Œè‹¥å¾€è‹¥è¿˜â€ã€‚



ç™¾åº¦ç®€ä»‹

å‡Œæ³¢å¾®æ­¥æ˜¯ã€Œé€é¥æ´¾ã€ç‹¬é—¨è½»åŠŸèº«æ³•ï¼Œç²¾å¦™å¼‚å¸¸ã€‚

å‡Œæ³¢å¾®æ­¥ä¹ƒæ˜¯ä¸€é—¨æä¸Šä¹˜çš„è½»åŠŸï¼Œæ‰€ä»¥åˆ—äºå·è½´ä¹‹æœ«ï¼Œä»¥æ˜“ç»å…«å…«å…­åå››å¦ä¸ºåŸºç¡€ï¼Œä½¿ç”¨è€…æŒ‰ç‰¹å®šé¡ºåºè¸ç€å¦è±¡æ–¹ä½è¡Œè¿›ï¼Œä»ç¬¬ä¸€æ­¥åˆ°æœ€åä¸€æ­¥æ­£å¥½è¡Œèµ°ä¸€ä¸ªå¤§åœˆã€‚æ­¤æ­¥æ³•ç²¾å¦™å¼‚å¸¸ï¼ŒåŸæ˜¯è¦å¾…äººç»ƒæˆã€ŒåŒ—å†¥ç¥åŠŸã€ï¼Œå¸äººå†…åŠ›ï¼Œè‡ªèº«å†…åŠ›å·²ã€é¢‡ä¸ºæ·±åšã€‘ä¹‹åå†ç»ƒã€‚

####################ç¬¬2æ®µç›¸å…³æ–‡æ¡£####################

ã€Šå¤©é¾™å…«éƒ¨ã€‹ç¬¬äº”å› å¾®æ­¥ç¸ çº¹ç”Ÿ

å·è½´ä¸­æ­¤å¤–è¯¸ç§ç»è„‰ä¿®ä¹ ä¹‹æ³•ç”šå¤šï¼Œçš†æ˜¯å–äººå†…åŠ›çš„æ³•é—¨ï¼Œæ®µèª‰è™½è‡ªè¯­å®½è§£ï¼Œæ€»è§‰ä¹ ä¹‹æœ‰è¿æœ¬æ€§ï¼Œå•æ˜¯è´ªå¤šåŠ¡å¾—ï¼Œä¾¿éå¥½äº‹ï¼Œå½“ä¸‹æš‚ä¸ç†ä¼šã€‚

å·åˆ°å·è½´æœ«ç«¯ï¼Œåˆè§åˆ°äº†â€œå‡Œæ³¢å¾®æ­¥â€é‚£å››å­—ï¼Œç™»æ—¶ä¾¿æƒ³èµ·ã€Šæ´›ç¥èµ‹ã€‹ä¸­é‚£äº›å¥å­æ¥ï¼šâ€œå‡Œæ³¢å¾®æ­¥ï¼Œç½—è¢œç”Ÿå°˜â€¦â€¦è½¬çœ„æµç²¾ï¼Œå…‰æ¶¦ç‰é¢œã€‚å«è¾æœªåï¼Œæ°”è‹¥å¹½å…°ã€‚åå®¹å©€å¨œï¼Œä»¤æˆ‘å¿˜é¤ã€‚â€æ›¹å­å»ºé‚£äº›åƒå¤åå¥ï¼Œåœ¨è„‘æµ·ä¸­ç¼“ç¼“æµè¿‡ï¼šâ€œç§¾çº¤å¾—è¡·ï¼Œä¿®çŸ­åˆåº¦ï¼Œè‚©è‹¥å‰Šæˆï¼Œè…°å¦‚çº¦ç´ ã€‚å»¶é¢ˆç§€é¡¹ï¼Œçš“è´¨å‘ˆéœ²ã€‚èŠ³æ³½æ— åŠ ï¼Œé“…åå¼—å¾¡ã€‚äº‘é«»å³¨å³¨ï¼Œä¿®çœ‰è¿å¨Ÿã€‚ä¸¹å”‡å¤–æœ—ï¼Œçš“é½¿å†…é²œã€‚æ˜çœ¸å–„çï¼Œé¥è¾…æ‰¿æƒã€‚ç‘°å§¿è‰³é€¸ï¼Œä»ªé™ä½“é—²ã€‚æŸ”æƒ…ç»°æ€ï¼Œåªšäºè¯­è¨€â€¦â€¦â€è¿™äº›å¥å­ç”¨åœ¨æœ¨å©‰æ¸…èº«ä¸Šï¼Œâ€œè¿™è¯å€’ä¹Ÿæœ‰ç†â€ï¼›ä½†å¦‚ç”¨ä¹‹äºç¥ä»™å§Šå§Šï¼Œåªæ€•æ›´ä¸ºé€‚åˆã€‚æƒ³åˆ°ç¥ä»™å§Šå§Šçš„å§¿å®¹ä½“æ€ï¼Œâ€œçšè‹¥å¤ªé˜³å‡æœéœï¼Œç¼è‹¥èŠ™è“‰å‡ºç»¿æ³¢â€ï¼Œä½†è§‰ä¾å¥¹å©å’è¡Œäº‹ï¼Œå®ä¸ºäººç”Ÿè‡³ä¹ï¼Œå¿ƒæƒ³ï¼šâ€œæˆ‘å…ˆæ¥ç»ƒè¿™â€˜å‡Œæ³¢å¾®æ­¥â€™ï¼Œæ­¤ä¹ƒé€ƒå‘½ä¹‹å¦™æ³•ï¼Œéå®³äººä¹‹æ‰‹æ®µä¹Ÿï¼Œç»ƒä¹‹æœ‰ç™¾åˆ©è€Œæ— ä¸€å®³ã€‚â€

####################ç¬¬3æ®µç›¸å…³æ–‡æ¡£####################

ã€Šå¤©é¾™å…«éƒ¨ã€‹ç¬¬äºŒå› ç‰å£æœˆåæ˜

å†å±•å¸›å·ï¼Œé•¿å·ä¸Šæºæºçš†æ˜¯è£¸å¥³ç”»åƒï¼Œæˆ–ç«‹æˆ–å§ï¼Œæˆ–ç°å‰èƒ¸ï¼Œæˆ–è§åèƒŒã€‚äººåƒçš„é¢å®¹éƒ½æ˜¯ä¸€èˆ¬ï¼Œä½†æˆ–å–œæˆ–æ„ï¼Œæˆ–å«æƒ…å‡çœ¸ï¼Œæˆ–è½»å—”è–„æ€’ï¼Œç¥æƒ…å„å¼‚ã€‚ä¸€å…±æœ‰ä¸‰åå…­å¹…å›¾åƒï¼Œæ¯å¹…åƒä¸Šå‡æœ‰é¢œè‰²ç»†çº¿ï¼Œæ³¨æ˜ç©´é“éƒ¨ä½åŠç»ƒåŠŸæ³•è¯€ã€‚

å¸›å·å°½å¤„é¢˜ç€â€œå‡Œæ³¢å¾®æ­¥â€å››å­—ï¼Œå…¶åç»˜çš„æ˜¯æ— æ•°è¶³å°ï¼Œæ³¨æ˜â€œå¦‡å¦¹â€ã€â€œæ— å¦„â€ç­‰ç­‰å­—æ ·ï¼Œå°½æ˜¯ã€Šæ˜“ç»ã€‹ä¸­çš„æ–¹ä½ã€‚æ®µèª‰å‰å‡ æ—¥è¿˜æ­£å…¨å¿ƒå…¨æ„åœ°é’»ç ”ã€Šæ˜“ç»ã€‹ï¼Œä¸€è§åˆ°è¿™äº›åç§°ï¼Œç™»æ—¶ç²¾ç¥å¤§æŒ¯ï¼Œä¾¿ä¼¼é‡åˆ°æ•…äº¤è‰¯å‹ä¸€èˆ¬ã€‚åªè§è¶³å°å¯†å¯†éº»éº»ï¼Œä¸çŸ¥æœ‰å‡ åƒç™¾ä¸ªï¼Œè‡ªä¸€ä¸ªè¶³å°è‡³å¦ä¸€ä¸ªè¶³å°å‡æœ‰ç»¿çº¿è´¯ä¸²ï¼Œçº¿ä¸Šç»˜æœ‰ç®­å¤´ï¼Œæœ€åå†™ç€ä¸€è¡Œå­—é“ï¼šâ€œæ­¥æ³•ç¥å¦™ï¼Œä¿èº«é¿æ•Œï¼Œå¾…ç§¯å†…åŠ›ï¼Œå†å–æ•Œå‘½ã€‚â€

æ®µèª‰å¿ƒé“ï¼šâ€œç¥ä»™å§Šå§Šæ‰€é—çš„æ­¥æ³•ï¼Œå¿…å®šç²¾å¦™ä¹‹æï¼Œé‡åˆ°å¼ºæ•Œæ—¶è„±èº«é€ƒèµ°ï¼Œé‚£å°±å¾ˆå¥½ï¼Œâ€˜å†å–æ•Œå‘½â€™ä¹Ÿå°±ä¸å¿…äº†ã€‚â€
å·å¥½å¸›å·ï¼Œå¯¹ä¹‹ä½œäº†ä¸¤ä¸ªæ–ï¼Œçè€Œé‡ä¹‹åœ°æ£å…¥æ€€ä¸­ï¼Œè½¬èº«å¯¹é‚£ç‰åƒé“ï¼šâ€œç¥ä»™å§Šå§Šï¼Œä½ å©å’æˆ‘æœåˆæ™šä¸‰æ¬¡ç»ƒåŠŸï¼Œæ®µèª‰ä¸æ•¢æœ‰è¿ã€‚ä»Šåæˆ‘å¯¹äººåŠ å€å®¢æ°”ï¼Œåˆ«äººä¸ä¼šæ¥æ‰“æˆ‘ï¼Œæˆ‘è‡ªç„¶ä¹Ÿä¸ä¼šå»å¸ä»–å†…åŠ›ã€‚ä½ è¿™å¥—â€˜å‡Œæ³¢å¾®æ­¥â€™æˆ‘æ›´è¦ç”¨å¿ƒç»ƒç†Ÿï¼Œçœ¼è§ä¸å¯¹ï¼Œç«‹åˆ»æºœä¹‹å¤§å‰ï¼Œå°±å¸ä¸åˆ°ä»–å†…åŠ›äº†ã€‚â€è‡³äºâ€œæ€å°½æˆ‘é€é¥æ´¾å¼Ÿå­â€ä¸€èŠ‚ï¼Œå´æƒ³ä¹Ÿä¸æ•¢å»æƒ³ã€‚

********ChatGLM:å‡Œæ³¢å¾®æ­¥æ˜¯ä¸€é—¨æä¸Šä¹˜çš„è½»åŠŸï¼Œæºäºã€Šæ˜“ç»ã€‹ä¸­çš„å…­åå››å¦ã€‚ä½¿ç”¨è€…æŒ‰ç…§ç‰¹å®šé¡ºåºè¸ç€å¦è±¡æ–¹ä½è¡Œè¿›ï¼Œä»ç¬¬ä¸€æ­¥åˆ°æœ€åä¸€æ­¥æ­£å¥½è¡Œèµ°ä¸€ä¸ªå¤§åœˆã€‚è¿™é—¨è½»åŠŸç²¾å¦™å¼‚å¸¸ï¼Œå¯ä»¥ä½¿äººå†…åŠ›å¢è¿›ï¼Œä½†éœ€è¦è°¨æ…ç»ƒä¹ ï¼Œé¿å…ä¼¤å®³ä»–äººã€‚å‡Œæ³¢å¾®æ­¥åœ¨é€é¥æ´¾ä¸­å°¤ä¸ºæµè¡Œï¼Œä½†å¹¶éæ‰€æœ‰é€é¥æ´¾å¼Ÿå­éƒ½ä¼šå‡Œæ³¢å¾®æ­¥ã€‚
```

```python
query = "ä½ çŸ¥é“vearchæ˜¯ä»€ä¹ˆå—?"
response, history = model.chat(tokenizer, query, history=history)
print(f"Human: {query}\nChatGLM:{response}\n")

vearch_info = [
    "Vearch æ˜¯ä¸€æ¬¾å­˜å‚¨å¤§è¯­è¨€æ¨¡å‹æ•°æ®çš„å‘é‡æ•°æ®åº“ï¼Œç”¨äºå­˜å‚¨å’Œå¿«é€Ÿæœç´¢æ¨¡å‹embeddingåçš„å‘é‡ï¼Œå¯ç”¨äºåŸºäºä¸ªäººçŸ¥è¯†åº“çš„å¤§æ¨¡å‹åº”ç”¨",
    "Vearch æ”¯æŒOpenAI, Llama, ChatGLMç­‰æ¨¡å‹ï¼Œä»¥åŠLangChainåº“",
    "vearch æ˜¯åŸºäºCè¯­è¨€,goè¯­è¨€å¼€å‘çš„ï¼Œå¹¶æä¾›pythonæ¥å£ï¼Œå¯ä»¥ç›´æ¥é€šè¿‡pipå®‰è£…",
]
vearch_source = [
    {
        "source": "/data/zhx/zhx/langchain-ChatGLM_new/knowledge_base/tlbb/three_body.txt"
    },
    {
        "source": "/data/zhx/zhx/langchain-ChatGLM_new/knowledge_base/tlbb/three_body.txt"
    },
    {
        "source": "/data/zhx/zhx/langchain-ChatGLM_new/knowledge_base/tlbb/three_body.txt"
    },
]
