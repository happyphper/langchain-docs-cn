---
title: 对 ClickHouse 运行支持查询
sidebarTitle: Run support queries against ClickHouse
---
此 Helm 仓库包含用于生成 LangSmith UI 目前不直接支持的输出的查询（例如，从 Clickhouse 获取查询异常日志）。

该命令接收一个包含嵌入式名称和密码的 Clickhouse 连接字符串（可以从密钥管理器的调用中传入），并执行来自输入文件的查询。在下面的示例中，我们使用 `support_queries/clickhouse` 目录中的 `ch_get_query_exceptions.sql` 输入文件。

### 前提条件

确保已准备好以下工具/项目。

1. kubectl

   * [https://kubernetes.io/docs/tasks/tools/](https://kubernetes.io/docs/tasks/tools/)

2. Clickhouse 数据库凭据

   * 主机
   * 端口
   * 用户名
     * 如果使用捆绑版本，则为 `default`
   * 密码
     * 如果使用捆绑版本，则为 `password`
   * 数据库名称
     * 如果使用捆绑版本，则为 `default`

3. 从您将运行迁移脚本的机器到 Clickhouse 数据库的连接性。

   * 如果您使用的是捆绑版本，可能需要将 clickhouse 服务端口转发到本地机器。
   * 运行 `kubectl port-forward svc/langsmith-clickhouse 8123:8123` 将 clickhouse 服务端口转发到本地机器。

4. 运行支持查询的脚本

   * 您可以从[此处](https://github.com/langchain-ai/helm/blob/main/charts/langsmith/scripts/run_support_query_ch.sh)下载该脚本

### 运行查询脚本

运行以下命令以执行所需的查询：

```bash
sh run_support_query_ch.sh <clickhouse_url> --input path/to/query.sql
```

例如，如果您使用带有端口转发的捆绑版本，命令可能如下所示：

```bash
sh run_support_query_ch.sh "clickhouse://default:password@localhost:8123/default" --input support_queries/clickhouse/ch_get_query_exceptions.sql
```

这将输出过去 7 天内在 Clickhouse 中抛出异常的所有查询的查询日志。要将其提取到文件中，请添加标志 `--output path/to/file.csv`
