---
title: 如何使用 pyproject.toml 设置应用程序
sidebarTitle: With pyproject.toml
---
import FrameworkAgnostic from '/snippets/langsmith/framework-agnostic.mdx';
import PrereleaseBehavior from '/snippets/langsmith/pre-release-behavior.mdx';

应用程序必须配置一个[配置文件](/langsmith/cli#configuration-file)才能部署到 LangSmith（或进行自托管）。本操作指南讨论了使用 `pyproject.toml` 定义包依赖关系来设置应用程序部署的基本步骤。

此示例基于[此仓库](https://github.com/langchain-ai/langgraph-example-pyproject)，它使用了 LangGraph 框架。

最终的仓库结构将类似于这样：

```bash
my-app/
├── my_agent # 所有项目代码都在这里
│   ├── utils # 图的实用工具
│   │   ├── __init__.py
│   │   ├── tools.py # 图的工具
│   │   ├── nodes.py # 图的节点函数
│   │   └── state.py # 图的状态定义
│   ├── __init__.py
│   └── agent.py # 构建图的代码
├── .env # 环境变量
├── langgraph.json  # LangGraph 的配置文件
└── pyproject.toml # 项目的依赖项
```
<Tip>
<FrameworkAgnostic/>
</Tip>

你也可以通过以下方式设置：

- `requirements.txt`：用于依赖管理，请查看[此操作指南](/langsmith/setup-app-requirements-txt)，了解如何在 LangSmith 中使用 `requirements.txt`。
- 单体仓库（monorepo）：要部署位于单体仓库内的图，请查看[此仓库](https://github.com/langchain-ai/langgraph-example-monorepo)以获取示例。

每个步骤之后，都会提供一个示例文件目录，以演示代码的组织方式。

## 指定依赖项

依赖项可以选择在以下文件之一中指定：`pyproject.toml`、`setup.py` 或 `requirements.txt`。如果这些文件都未创建，则可以在稍后的[配置文件](#create-the-configuration-file)中指定依赖项。

以下依赖项将包含在镜像中，只要版本范围兼容，你也可以在代码中使用它们：

```
langgraph>=0.4.10,<2
langgraph-sdk>=0.2.0
langgraph-checkpoint>=3.0.1,<5
langchain-core>=0.3.64
langsmith>=0.3.45
orjson>=3.9.7,<3.10.17
httpx>=0.25.0
tenacity>=8.0.0
uvicorn>=0.26.0
sse-starlette>=2.1.0,<2.2.0
uvloop>=0.18.0
httptools>=0.5.0
jsonschema-rs>=0.20.0
structlog>=24.1.0
cloudpickle>=3.0.0
truststore>=0.1
protobuf>=6.32.1,<7.0.0
grpcio>=1.75.0,<2.0.0
grpcio-tools>=1.75.0,<2.0.0
grpcio-health-checking>=1.75.0,<2.0.0
```

示例 `pyproject.toml` 文件：

```toml
[build-system]
requires = ["hatchling"]
build-backend = "hatchling.build"

[project]
name = "my-agent"
version = "0.0.1"
description = "An excellent agent build for LangSmith."
authors = [
    {name = "Polly the parrot", email = "1223+polly@users.noreply.github.com"}
]
license = {text = "MIT"}
readme = "README.md"
requires-python = ">=3.9"
dependencies = [
    "langgraph>=0.6.0",
    "langchain-fireworks>=0.1.3"
]

[tool.hatch.build.targets.wheel]
packages = ["my_agent"]
```

示例文件目录：

```bash
my-app/
└── pyproject.toml   # 图所需的 Python 包
```

## 指定环境变量

环境变量可以选择在文件中指定（例如 `.env`）。请参阅[环境变量参考](/langsmith/env-var)以配置部署的额外变量。

示例 `.env` 文件：

```
MY_ENV_VAR_1=foo
MY_ENV_VAR_2=bar
FIREWORKS_API_KEY=key
```

示例文件目录：

```bash
my-app/
├── .env # 包含环境变量的文件
└── pyproject.toml
```

<Tip>
<PrereleaseBehavior/>
</Tip>

## 定义图

实现你的图。图可以在单个文件或多个文件中定义。请注意要包含在应用程序中的每个 `@[CompiledStateGraph]` 的变量名。这些变量名将在稍后创建[配置文件](/langsmith/cli#configuration-file)时使用。

示例 `agent.py` 文件，展示了如何从你定义的其他模块导入（此处未显示模块的代码，请查看[此仓库](https://github.com/langchain-ai/langgraph-example-pyproject)以查看其实现）：

```python
# my_agent/agent.py
from typing import Literal
from typing_extensions import TypedDict

from langgraph.graph import StateGraph, END, START
from my_agent.utils.nodes import call_model, should_continue, tool_node # 导入节点
from my_agent.utils.state import AgentState # 导入状态

# 定义运行时上下文
class GraphContext(TypedDict):
    model_name: Literal["anthropic", "openai"]

workflow = StateGraph(AgentState, context_schema=GraphContext)
workflow.add_node("agent", call_model)
workflow.add_node("action", tool_node)
workflow.add_edge(START, "agent")
workflow.add_conditional_edges(
    "agent",
    should_continue,
    {
        "continue": "action",
        "end": END,
    },
)
workflow.add_edge("action", "agent")

graph = workflow.compile()
```

示例文件目录：

```bash
my-app/
├── my_agent # 所有项目代码都在这里
│   ├── utils # 图的实用工具
│   │   ├── __init__.py
│   │   ├── tools.py # 图的工具
│   │   ├── nodes.py # 图的节点函数
│   │   └── state.py # 图的状态定义
│   ├── __init__.py
│   └── agent.py # 构建图的代码
├── .env
└── pyproject.toml
```

## 创建配置文件

创建一个名为 `langgraph.json` 的[配置文件](/langsmith/cli#configuration-file)。有关配置文件中 JSON 对象每个键的详细说明，请参阅[配置文件参考](/langsmith/cli#configuration-file)。

示例 `langgraph.json` 文件：

```json
{
  "dependencies": ["."],
  "graphs": {
    "agent": "./my_agent/agent.py:graph"
  },
  "env": ".env"
}
```

请注意，`CompiledGraph` 的变量名出现在顶级 `graphs` 键的每个子键值的末尾（即 `:<variable_name>`）。

<Warning>
    **配置文件位置**
    配置文件必须放置在与包含已编译图及其相关依赖项的 Python 文件同级或更高级别的目录中。
</Warning>

示例文件目录：

```bash
my-app/
├── my_agent # 所有项目代码都在这里
│   ├── utils # 图的实用工具
│   │   ├── __init__.py
│   │   ├── tools.py # 图的工具
│   │   ├── nodes.py # 图的节点函数
│   │   └── state.py # 图的状态定义
│   ├── __init__.py
│   └── agent.py # 构建图的代码
├── .env # 环境变量
├── langgraph.json  # LangGraph 的配置文件
└── pyproject.toml # 项目的依赖项
```

## 下一步

设置好项目并将其放入 GitHub 仓库后，就可以[部署你的应用程序](/langsmith/deployment-quickstart)了。
