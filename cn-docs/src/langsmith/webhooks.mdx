---
title: ä¸ºè§„åˆ™é…ç½® Webhook é€šçŸ¥
sidebarTitle: Configure webhook notifications for rules
---
å½“æ‚¨åœ¨è‡ªåŠ¨åŒ–æ“ä½œä¸­æ·»åŠ  webhook URL æ—¶ï¼Œæ¯å½“æ‚¨å®šä¹‰çš„è§„åˆ™åŒ¹é…åˆ°ä»»ä½•æ–°è¿è¡Œæ—¶ï¼Œæˆ‘ä»¬éƒ½ä¼šå‘æ‚¨çš„ webhook ç«¯ç‚¹å‘é€ä¸€ä¸ª POST è¯·æ±‚ã€‚

![Webhook](/langsmith/images/webhook.png)

## Webhook è´Ÿè½½

æˆ‘ä»¬å‘é€åˆ°æ‚¨çš„ webhook ç«¯ç‚¹çš„è´Ÿè½½åŒ…å«ï¼š

- `"rule_id"`ï¼šè¿™æ˜¯å‘é€æ­¤è´Ÿè½½çš„è‡ªåŠ¨åŒ–çš„ ID
- `"start_time"` å’Œ `"end_time"`ï¼šè¿™æ˜¯æˆ‘ä»¬æ‰¾åˆ°åŒ¹é…è¿è¡Œçš„æ—¶é—´è¾¹ç•Œ
- `"runs"`ï¼šè¿™æ˜¯ä¸€ä¸ªè¿è¡Œæ•°ç»„ï¼Œå…¶ä¸­æ¯ä¸ªè¿è¡Œéƒ½æ˜¯ä¸€ä¸ªå­—å…¸ã€‚å¦‚æœæ‚¨éœ€è¦å…³äºæ¯ä¸ªè¿è¡Œçš„æ›´å¤šä¿¡æ¯ï¼Œæˆ‘ä»¬å»ºè®®åœ¨æ‚¨çš„ç«¯ç‚¹ä¸­ä½¿ç”¨æˆ‘ä»¬çš„ SDK ä» API è·å–ã€‚
- `"feedback_stats"`ï¼šè¿™æ˜¯ä¸€ä¸ªåŒ…å«è¿è¡Œåé¦ˆç»Ÿè®¡ä¿¡æ¯çš„å­—å…¸ã€‚æ­¤å­—æ®µçš„ç¤ºä¾‹è´Ÿè½½å¦‚ä¸‹æ‰€ç¤ºã€‚

```json
"feedback_stats": {
    "about_langchain": {
        "n": 1,
        "avg": 0.0,
        "show_feedback_arrow": true,
        "values": {}
    },
    "category": {
        "n": 0,
        "avg": null,
        "show_feedback_arrow": true,
        "values": {
            "CONCEPTUAL": 1
        }
    },
    "user_score": {
        "n": 2,
        "avg": 0.0,
        "show_feedback_arrow": false,
        "values": {}
    },
    "vagueness": {
        "n": 1,
        "avg": 0.0,
        "show_feedback_arrow": true,
        "values": {}
    }
}
```

<Note>
**ä» S3 URL è·å–æ•°æ®**

æ ¹æ®æ‚¨çš„è¿è¡Œçš„æ–°æ—§ç¨‹åº¦ï¼Œ`inputs_s3_urls` å’Œ `outputs_s3_urls` å­—æ®µå¯èƒ½åŒ…å«æŒ‡å‘å®é™…æ•°æ®çš„ S3 URLï¼Œè€Œä¸æ˜¯æ•°æ®æœ¬èº«ã€‚

`inputs` å’Œ `outputs` å¯ä»¥åˆ†åˆ«é€šè¿‡ `inputs_s3_urls` å’Œ `outputs_s3_urls` ä¸­æä¾›çš„ `ROOT.presigned_url` æ¥è·å–ã€‚
</Note>

è¿™æ˜¯æˆ‘ä»¬å‘é€åˆ°æ‚¨çš„ webhook ç«¯ç‚¹çš„å®Œæ•´è´Ÿè½½ç¤ºä¾‹ï¼š

```json
{
  "rule_id": "d75d7417-0c57-4655-88fe-1db3cda3a47a",
  "start_time": "2024-04-05T01:28:54.734491+00:00",
  "end_time": "2024-04-05T01:28:56.492563+00:00",
  "runs": [
    {
      "status": "success",
      "is_root": true,
      "trace_id": "6ab80f10-d79c-4fa2-b441-922ed6feb630",
      "dotted_order": "20230505T051324571809Z6ab80f10-d79c-4fa2-b441-922ed6feb630",
      "run_type": "tool",
      "modified_at": "2024-04-05T01:28:54.145062",
      "tenant_id": "2ebda79f-2946-4491-a9ad-d642f49e0815",
      "end_time": "2024-04-05T01:28:54.085649",
      "name": "Search",
      "start_time": "2024-04-05T01:28:54.085646",
      "id": "6ab80f10-d79c-4fa2-b441-922ed6feb630",
      "session_id": "6a3be6a2-9a8c-4fc8-b4c6-a8983b286cc5",
      "parent_run_ids": [],
      "child_run_ids": null,
      "direct_child_run_ids": null,
      "total_tokens": 0,
      "completion_tokens": 0,
      "prompt_tokens": 0,
      "total_cost": null,
      "completion_cost": null,
      "prompt_cost": null,
      "first_token_time": null,
      "app_path": "/o/2ebda79f-2946-4491-a9ad-d642f49e0815/projects/p/6a3be6a2-9a8c-4fc8-b4c6-a8983b286cc5/r/6ab80f10-d79c-4fa2-b441-922ed6feb630?trace_id=6ab80f10-d79c-4fa2-b441-922ed6feb630&start_time=2023-05-05T05:13:24.571809",
      "in_dataset": false,
      "last_queued_at": null,
      "inputs": null,
      "inputs_s3_urls": null,
      "outputs": null,
      "outputs_s3_urls": null,
      "extra": null,
      "events": null,
      "feedback_stats": null,
      "serialized": null,
      "share_token": null
    }
  ]
}
```

## å®‰å…¨æ€§

æˆ‘ä»¬å¼ºçƒˆå»ºè®®æ‚¨åœ¨ webhook URL ä¸­æ·»åŠ ä¸€ä¸ªç§˜å¯†æŸ¥è¯¢å­—ç¬¦ä¸²å‚æ•°ï¼Œå¹¶åœ¨ä»»ä½•ä¼ å…¥è¯·æ±‚ä¸­éªŒè¯å®ƒã€‚è¿™ç¡®ä¿äº†å¦‚æœæœ‰äººå‘ç°äº†æ‚¨çš„ webhook URLï¼Œæ‚¨å¯ä»¥åŒºåˆ†è¿™äº›è°ƒç”¨ä¸çœŸå®çš„ webhook é€šçŸ¥ã€‚

ä¸€ä¸ªä¾‹å­æ˜¯ï¼š

```
https://api.example.com/langsmith_webhook?secret=38ee77617c3a489ab6e871fbeb2ec87d
```

### Webhook è‡ªå®šä¹‰ HTTP å¤´

å¦‚æœæ‚¨å¸Œæœ›éš webhook å‘é€ä»»ä½•ç‰¹å®šçš„å¤´éƒ¨ä¿¡æ¯ï¼Œè¿™å¯ä»¥æŒ‰ URL è¿›è¡Œé…ç½®ã€‚è¦è¿›è¡Œè®¾ç½®ï¼Œè¯·ç‚¹å‡» URL å­—æ®µæ—è¾¹çš„ `Headers` é€‰é¡¹å¹¶æ·»åŠ æ‚¨çš„å¤´éƒ¨ä¿¡æ¯ã€‚

<Note>
å¤´éƒ¨ä¿¡æ¯ä»¥åŠ å¯†æ ¼å¼å­˜å‚¨ã€‚
</Note>

![Webhook headers](/langsmith/images/webhook-headers.png)

### Webhook äº¤ä»˜

åœ¨å‘æ‚¨çš„ webhook ç«¯ç‚¹äº¤ä»˜äº‹ä»¶æ—¶ï¼Œæˆ‘ä»¬éµå¾ªä»¥ä¸‹å‡†åˆ™ï¼š

- å¦‚æœæˆ‘ä»¬æ— æ³•è¿æ¥åˆ°æ‚¨çš„ç«¯ç‚¹ï¼Œæˆ‘ä»¬ä¼šé‡è¯•ä¼ è¾“è¿æ¥æœ€å¤š 2 æ¬¡ï¼Œç„¶åå®£å¸ƒäº¤ä»˜å¤±è´¥ã€‚
- å¦‚æœæ‚¨çš„ç«¯ç‚¹éœ€è¦è¶…è¿‡ 5 ç§’æ¥å›å¤ï¼Œæˆ‘ä»¬å®£å¸ƒäº¤ä»˜å¤±è´¥ï¼Œå¹¶ä¸”ä¸ä¼šé‡è¯•ã€‚
- å¦‚æœæ‚¨çš„ç«¯ç‚¹åœ¨ 5 ç§’å†…è¿”å› 5xx çŠ¶æ€ç ï¼Œæˆ‘ä»¬ä¼šä½¿ç”¨æŒ‡æ•°é€€é¿é‡è¯•æœ€å¤š 2 æ¬¡ã€‚
- å¦‚æœæ‚¨çš„ç«¯ç‚¹è¿”å› 4xx çŠ¶æ€ç ï¼Œæˆ‘ä»¬å®£å¸ƒäº¤ä»˜å¤±è´¥ï¼Œå¹¶ä¸”ä¸ä¼šé‡è¯•ã€‚
- æ‚¨çš„ç«¯ç‚¹åœ¨å“åº”ä½“ä¸­è¿”å›çš„ä»»ä½•å†…å®¹éƒ½å°†è¢«å¿½ç•¥ã€‚

## Modal ç¤ºä¾‹

### è®¾ç½®

å…³äºå¦‚ä½•è®¾ç½®æ­¤åŠŸèƒ½çš„ç¤ºä¾‹ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ [Modal](https://modal.com/)ã€‚Modal ä¸ºæ¨ç†å’Œå¾®è°ƒæä¾›è‡ªåŠ¨æ‰©å±•çš„ GPUï¼Œä¸ºä»£ç ä»£ç†æä¾›å®‰å…¨çš„å®¹å™¨åŒ–ï¼Œä»¥åŠæ— æœåŠ¡å™¨ Python web ç«¯ç‚¹ã€‚è¿™é‡Œæˆ‘ä»¬å°†é‡ç‚¹ä»‹ç» web ç«¯ç‚¹ã€‚

é¦–å…ˆï¼Œåˆ›å»ºä¸€ä¸ª Modal è´¦æˆ·ã€‚ç„¶åï¼Œåœ¨æœ¬åœ°å®‰è£… Modal SDKï¼š

<CodeGroup>
```bash pip
pip install modal
```

```bash uv
uv add modal
```
</CodeGroup>

è¦å®Œæˆè´¦æˆ·è®¾ç½®ï¼Œè¯·è¿è¡Œå‘½ä»¤ï¼š

```shell
modal setup
```

å¹¶æŒ‰ç…§è¯´æ˜æ“ä½œã€‚

### å¯†é’¥

æ¥ä¸‹æ¥ï¼Œæ‚¨éœ€è¦åœ¨ Modal ä¸­è®¾ç½®ä¸€äº›å¯†é’¥ã€‚

é¦–å…ˆï¼ŒLangSmith éœ€è¦é€šè¿‡ä¼ å…¥ä¸€ä¸ªå¯†é’¥æ¥å‘ Modal è¿›è¡Œèº«ä»½éªŒè¯ã€‚
æœ€ç®€å•çš„æ–¹æ³•æ˜¯åœ¨æŸ¥è¯¢å‚æ•°ä¸­ä¼ é€’ä¸€ä¸ªå¯†é’¥ã€‚
ä¸ºäº†éªŒè¯æ­¤å¯†é’¥ï¼Œæˆ‘ä»¬éœ€è¦åœ¨ _Modal_ ä¸­æ·»åŠ ä¸€ä¸ªå¯†é’¥è¿›è¡ŒéªŒè¯ã€‚
æˆ‘ä»¬å°†é€šè¿‡åˆ›å»ºä¸€ä¸ª Modal å¯†é’¥æ¥å®ç°ã€‚
æ‚¨å¯ä»¥åœ¨æ­¤å¤„æŸ¥çœ‹å…³äºå¯†é’¥çš„è¯´æ˜ [here](https://modal.com/docs/guide/secrets)ã€‚
ä¸ºæ­¤ï¼Œè®©æˆ‘ä»¬å°†æˆ‘ä»¬çš„å¯†é’¥å‘½åä¸º `ls-webhook`ï¼Œå¹¶è®©å®ƒè®¾ç½®ä¸€ä¸ªåä¸º `LS_WEBHOOK` çš„ç¯å¢ƒå˜é‡ã€‚

æˆ‘ä»¬è¿˜å¯ä»¥è®¾ç½®ä¸€ä¸ª LangSmith å¯†é’¥ - å¹¸è¿çš„æ˜¯ï¼Œå·²ç»æœ‰ä¸€ä¸ªç”¨äºæ­¤ç›®çš„çš„é›†æˆæ¨¡æ¿ï¼

![LangSmith Modal Template](/langsmith/images/modal-langsmith-secret.png)

### æœåŠ¡

ä¹‹åï¼Œæ‚¨å¯ä»¥åˆ›å»ºä¸€ä¸ª Python æ–‡ä»¶ï¼Œå®ƒå°†ä½œä¸ºæ‚¨çš„ç«¯ç‚¹ã€‚
ä¸‹é¢æ˜¯ä¸€ä¸ªç¤ºä¾‹ï¼Œå¹¶é™„æœ‰è§£é‡Šè¯´æ˜ï¼š

```python
from fastapi import HTTPException, status, Request, Query
from modal import Secret, Stub, web_endpoint, Image

stub = Stub("auth-example", image=Image.debian_slim().pip_install("langsmith"))


@stub.function(
    secrets=[Secret.from_name("ls-webhook"), Secret.from_name("my-langsmith-secret")]
)
# æˆ‘ä»¬å¸Œæœ›è¿™æ˜¯ä¸€ä¸ª `POST` ç«¯ç‚¹ï¼Œå› ä¸ºæˆ‘ä»¬å°†åœ¨æ­¤å¤„å‘å¸ƒæ•°æ®
@web_endpoint(method="POST")
# æˆ‘ä»¬è®¾ç½®ä¸€ä¸ª `secret` æŸ¥è¯¢å‚æ•°
def f(data: dict, secret: str = Query(...)):
    # æ‚¨å¯ä»¥åœ¨ Modal å‡½æ•°å†…éƒ¨å¯¼å…¥æœ¬åœ°æ²¡æœ‰çš„ä¾èµ–é¡¹
    from langsmith import Client

    # é¦–å…ˆï¼Œæˆ‘ä»¬éªŒè¯æˆ‘ä»¬ä¼ é€’çš„å¯†é’¥
    import os

    if secret != os.environ["LS_WEBHOOK"]:
        raise HTTPException(
            status_code=status.HTTP_401_UNAUTHORIZED,
            detail="Incorrect bearer token",
            headers={"WWW-Authenticate": "Bearer"},
        )

    # è¿™æ˜¯æˆ‘ä»¬åœ¨ webhook å†…éƒ¨æ”¾ç½®é€»è¾‘çš„åœ°æ–¹
    ls_client = Client()
    runs = data["runs"]
    ids = [r["id"] for r in runs]
    feedback = list(ls_client.list_feedback(run_ids=ids))
    for r, f in zip(runs, feedback):
        try:
            ls_client.create_example(
                inputs=r["inputs"],
                outputs={"output": f.correction},
                dataset_name="classifier-github-issues",
            )
        except Exception:
            raise ValueError(f"{r} and {f}")
    # å‡½æ•°ä½“
    return "success!"
```

ç°åœ¨æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ `modal deploy ...` è½»æ¾éƒ¨ç½²æ­¤ä»£ç ï¼ˆè¯·å‚é˜…æ–‡æ¡£ [here](https://modal.com/docs/guide/managing-deployments)ï¼‰ã€‚

æ‚¨ç°åœ¨åº”è¯¥ä¼šå¾—åˆ°ç±»ä¼¼ä»¥ä¸‹çš„å†…å®¹ï¼š

```
âœ“ Created objects.
â”œâ”€â”€ ğŸ”¨ Created mount /Users/harrisonchase/workplace/langsmith-docs/example-webhook.py
â”œâ”€â”€ ğŸ”¨ Created mount PythonPackage:langsmith
â””â”€â”€ ğŸ”¨ Created f => https://hwchase17--auth-example-f.modal.run
âœ“ App deployed! ğŸ‰

View Deployment: https://modal.com/apps/hwchase17/auth-example
```

éœ€è¦è®°ä½çš„é‡è¦äº‹æƒ…æ˜¯ `https://hwchase17--auth-example-f.modal.run` - è¿™æ˜¯æˆ‘ä»¬åˆ›å»ºçš„ç”¨äºè¿è¡Œçš„å‡½æ•°ã€‚
æ³¨æ„ï¼šè¿™ä¸æ˜¯æœ€ç»ˆçš„éƒ¨ç½² URLï¼Œè¯·ç¡®ä¿ä¸è¦æ„å¤–ä½¿ç”¨å®ƒã€‚

### è¿æ¥å®ƒ

ç°åœ¨æˆ‘ä»¬å¯ä»¥è·å–ä¸Šé¢åˆ›å»ºçš„å‡½æ•° URL å¹¶å°†å…¶æ·»åŠ ä¸º webhookã€‚
æˆ‘ä»¬å¿…é¡»è®°ä½è¿˜è¦å°†å¯†é’¥ä½œä¸ºæŸ¥è¯¢å‚æ•°ä¼ é€’ã€‚
å°†æ‰€æœ‰å†…å®¹æ”¾åœ¨ä¸€èµ·ï¼Œå®ƒåº”è¯¥çœ‹èµ·æ¥åƒï¼š

```
https://hwchase17--auth-example-f-dev.modal.run?secret={SECRET}
```

å°† `{SECRET}` æ›¿æ¢ä¸ºæ‚¨åˆ›å»ºçš„ç”¨äºè®¿é—® Modal æœåŠ¡çš„å¯†é’¥ã€‚
