---
title: ChatCloudflareWorkersAI
---
[Workers AI](https://developers.cloudflare.com/workers-ai/) 允许您在自己的代码中，于 Cloudflare 网络之上运行机器学习模型。

本文将帮助您开始使用 Cloudflare Workers AI 的[聊天模型](/oss/langchain/models)。有关 `ChatCloudflareWorkersAI` 所有功能和配置的详细文档，请查阅 [API 参考](https://api.js.langchain.com/classes/langchain_cloudflare.ChatCloudflareWorkersAI.html)。

## 概述

### 集成详情

| 类 | 包 | 可序列化 | PY 支持 | 下载量 | 版本 |
| :--- | :--- | :---: |  :---: | :---: | :---: |
| [`ChatCloudflareWorkersAI`](https://api.js.langchain.com/classes/langchain_cloudflare.ChatCloudflareWorkersAI.html) | [`@langchain/cloudflare`](https://npmjs.com/@langchain/cloudflare) | ✅ | ❌ | ![NPM - Downloads](https://img.shields.io/npm/dm/@langchain/cloudflare?style=flat-square&label=%20&) | ![NPM - Version](https://img.shields.io/npm/v/@langchain/cloudflare?style=flat-square&label=%20&) |

### 模型功能

请参阅下表标题中的链接，了解如何使用特定功能的指南。

| [工具调用](/oss/langchain/tools) | [结构化输出](/oss/langchain/structured-output) | [图像输入](/oss/langchain/messages#multimodal) | 音频输入 | 视频输入 | [令牌级流式传输](/oss/langchain/streaming/) | [令牌使用量](/oss/langchain/models#token-usage) | [对数概率](/oss/langchain/models#log-probabilities) |
| :---: | :---: | :---: |  :---: | :---: | :---: | :---: | :---: |
| ❌ | ❌ | ✅ | ❌ | ❌ | ✅ | ❌ | ❌ |

## 设置

要访问 Cloudflare Workers AI 模型，您需要创建一个 Cloudflare 账户，获取一个 API 密钥，并安装 `@langchain/cloudflare` 集成包。

### 凭证

请前往[此页面](https://developers.cloudflare.com/workers-ai/)注册 Cloudflare 并生成 API 密钥。完成后，请记下您的 `CLOUDFLARE_ACCOUNT_ID` 和 `CLOUDFLARE_API_TOKEN`。

目前尚不支持在 Cloudflare Worker 内部传递绑定。

### 安装

LangChain ChatCloudflareWorkersAI 集成位于 `@langchain/cloudflare` 包中：

<CodeGroup>
```bash npm
npm install @langchain/cloudflare @langchain/core
```
```bash yarn
yarn add @langchain/cloudflare @langchain/core
```
```bash pnpm
pnpm add @langchain/cloudflare @langchain/core
```
</CodeGroup>

## 实例化

现在我们可以实例化我们的模型对象并生成聊天补全：

```typescript
// @lc-docs-hide-cell

// @ts-expect-error Deno is not recognized
const CLOUDFLARE_ACCOUNT_ID = Deno.env.get("CLOUDFLARE_ACCOUNT_ID");
// @ts-expect-error Deno is not recognized
const CLOUDFLARE_API_TOKEN = Deno.env.get("CLOUDFLARE_API_TOKEN");
```

```typescript
import { ChatCloudflareWorkersAI } from "@langchain/cloudflare";

const llm = new ChatCloudflareWorkersAI({
  model: "@cf/meta/llama-2-7b-chat-int8", // 默认值
  cloudflareAccountId: CLOUDFLARE_ACCOUNT_ID,
  cloudflareApiToken: CLOUDFLARE_API_TOKEN,
  // 传递自定义基础 URL 以使用 Cloudflare AI Gateway
  // baseUrl: `https://gateway.ai.cloudflare.com/v1/{YOUR_ACCOUNT_ID}/{GATEWAY_NAME}/workers-ai/`,
});
```

## 调用

```typescript
const aiMsg = await llm.invoke([
  [
    "system",
    "You are a helpful assistant that translates English to French. Translate the user sentence.",
  ],
  ["human", "I love programming."],
])
aiMsg
```

```text
AIMessage {
  lc_serializable: true,
  lc_kwargs: {
    content: 'I can help with that! The translation of "I love programming" in French is:\n' +
      "\n" +
      `"J'adore le programmati`... 4 more characters,
    tool_calls: [],
    invalid_tool_calls: [],
    additional_kwargs: {},
    response_metadata: {}
  },
  lc_namespace: [ "langchain_core", "messages" ],
  content: 'I can help with that! The translation of "I love programming" in French is:\n' +
    "\n" +
    `"J'adore le programmati`... 4 more characters,
  name: undefined,
  additional_kwargs: {},
  response_metadata: {},
  tool_calls: [],
  invalid_tool_calls: []
}
```

```typescript
console.log(aiMsg.content)
```

```text
I can help with that! The translation of "I love programming" in French is:

"J'adore le programmation."
```

---

## API 参考

有关 `ChatCloudflareWorkersAI` 所有功能和配置的详细文档，请查阅 [API 参考](https://api.js.langchain.com/classes/langchain_cloudflare.ChatCloudflareWorkersAI.html)。
