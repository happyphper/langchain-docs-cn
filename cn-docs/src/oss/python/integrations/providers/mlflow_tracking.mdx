---
title: MLflow
---
>[MLflow](https://mlflow.org/) 是一个多功能、开源的平台，用于管理机器学习和生成式 AI 生命周期中的工作流和工件。它内置了与许多流行 AI 和 ML 库的集成，但也可以与任何库、算法或部署工具一起使用。

MLflow 的 [LangChain 集成](https://mlflow.org/docs/latest/llms/langchain/autologging.html) 提供以下功能：

- **[追踪](https://mlflow.org/docs/latest/llms/langchain/autologging.html)**：通过一行代码 (`mlflow.langchain.autolog()`) 可视化数据在 LangChain 组件中的流动。
- **[实验追踪](https://mlflow.org/docs/latest/llms/langchain/index.html#experiment-tracking)**：记录 LangChain 运行中的工件、代码和指标。
- **[模型管理](https://mlflow.org/docs/latest/model-registry.html)**：对 LangChain 应用程序进行版本控制和部署，并跟踪依赖关系。
- **[评估](https://mlflow.org/docs/latest/llms/langchain/index.html#mlflow-evaluate)**：衡量 LangChain 应用程序的性能。

**注意**：MLflow 追踪功能在 MLflow 2.14.0 及更高版本中可用。

本简短指南重点介绍 MLflow 对 LangChain 和 LangGraph 应用程序的追踪能力。您将看到如何通过一行代码启用追踪，并查看应用程序的执行流程。有关 MLflow 其他功能的信息以及更多教程，请参阅 [MLflow 的 LangChain 文档](https://mlflow.org/docs/latest/llms/langchain/index.html)。如果您是 MLflow 的新手，请查看 [MLflow 入门指南](https://mlflow.org/docs/latest/getting-started/index.html)。

## 设置

要开始使用 MLflow 对 LangChain 进行追踪，请安装 MLflow Python 包。我们还将使用 `langchain-openai` 包。

```python
pip install mlflow langchain-openai langgraph -qU
```

接下来，设置 MLflow 追踪 URI 和 OpenAI API 密钥。

```python
import os

# 如果您正在运行 MLflow Tracking Server，请设置 MLflow 追踪 URI
os.environ["MLFLOW_TRACKING_URI"] = ""
os.environ["OPENAI_API_KEY"] = ""
```

## MLflow 追踪

MLflow 的追踪功能可帮助您可视化 LangChain 应用程序的执行流程。以下是启用方法。

```python
import mlflow

# 可选：设置一个实验来组织您的追踪记录
mlflow.set_experiment("LangChain MLflow Integration")

# 启用追踪
mlflow.langchain.autolog()
```

## 示例：追踪 LangChain 应用程序

以下是一个展示 MLflow 追踪 LangChain 的完整示例：

```python
import mlflow
from langchain_core.output_parsers import StrOutputParser
from langchain_core.prompts import ChatPromptTemplate
from langchain_openai import ChatOpenAI

# 启用 MLflow 追踪
mlflow.langchain.autolog()

# 创建一个简单的链
llm = ChatOpenAI(model_name="gpt-4o")

prompt = ChatPromptTemplate.from_messages(
    [
        (
            "system",
            "You are a helpful assistant that translates {input_language} to {output_language}.",
        ),
        ("human", "{input}"),
    ]
)

chain = prompt | llm | StrOutputParser()

# 运行链
result = chain.invoke(
    {
        "input_language": "English",
        "output_language": "German",
        "input": "I love programming.",
    }
)
```

要查看追踪记录，请在终端中运行 `mlflow ui`，并在 MLflow UI 中导航到 "Traces" 标签页。

## 示例：追踪 LangGraph 应用程序

MLflow 也支持追踪 LangGraph 应用程序：

```python
import mlflow
from langchain.tools import tool
from langchain.agents import create_agent


# 启用 MLflow 追踪
mlflow.langchain.autolog()


# 定义一个工具
@tool
def count_words(text: str) -> str:
    """Counts the number of words in a text."""
    word_count = len(text.split())
    return f"This text contains {word_count} words."


# 创建一个 LangGraph 智能体
llm = ChatOpenAI(model="gpt-4o")
tools = [count_words]
graph = create_agent(llm, tools)

# 运行智能体
result = graph.invoke(
    {"messages": [{"role": "user", "content": "Write me a 71-word story about a cat."}]}
)
```

要查看追踪记录，请在终端中运行 `mlflow ui`，并在 MLflow UI 中导航到 "Traces" 标签页。

## 资源

有关将 MLflow 与 LangChain 结合使用的更多信息，请访问：

- [MLflow LangChain 集成文档](https://mlflow.org/docs/latest/llms/langchain/index.html)
- [MLflow 追踪文档](https://mlflow.org/docs/latest/llms/tracing/index.html)
- [记录 LangChain 和 LangGraph 模型](https://mlflow.org/docs/latest/llms/langchain/index.html#logging-models-from-code)
- [评估 LangChain 和 LangGraph 模型](https://mlflow.org/docs/latest/llms/langchain/index.html#how-can-i-evaluate-a-langgraph-agent)
