---
title: Google Generative AI Embeddings（AI Studio 与 Gemini API）
sidebarTitle: GoogleGenerativeAIEmbeddings
---
使用 `GoogleGenerativeAIEmbeddings` 类连接 Google 的生成式 AI 嵌入服务，该类位于 [langchain-google-genai](https://pypi.org/project/langchain-google-genai/) 包中。

这将帮助您开始使用 LangChain 集成 Google 的生成式 AI 嵌入模型（如 Gemini）。有关 `GoogleGenerativeAIEmbeddings` 功能和配置选项的详细文档，请参阅 [API 参考](https://python.langchain.com/v0.2/api_reference/google_genai/embeddings/langchain_google_genai.embeddings.GoogleGenerativeAIEmbeddings.html)。

## 概述

### 集成详情

<ItemTable category="text_embedding" item="Google Gemini" />

## 设置

要访问 Google 生成式 AI 嵌入模型，您需要创建一个 Google Cloud 项目，启用 Generative Language API，获取一个 API 密钥，并安装 `langchain-google-genai` 集成包。

### 凭证

要使用 Google 生成式 AI 模型，您必须拥有一个 API 密钥。您可以在 Google AI Studio 中创建一个。请参阅 [Google 文档](https://ai.google.dev/gemini-api/docs/api-key) 获取说明。

获取密钥后，将其设置为环境变量 `GOOGLE_API_KEY`：

```python
import getpass
import os

if not os.getenv("GOOGLE_API_KEY"):
    os.environ["GOOGLE_API_KEY"] = getpass.getpass("Enter your Google API key: ")
```

要启用模型调用的自动追踪，请设置您的 [LangSmith](https://docs.langchain.com/langsmith/home) API 密钥：

```python
os.environ["LANGSMITH_TRACING"] = "true"
os.environ["LANGSMITH_API_KEY"] = getpass.getpass("Enter your LangSmith API key: ")
```

## 安装

```python
pip install -qU  langchain-google-genai
```

## 用法

```python
from langchain_google_genai import GoogleGenerativeAIEmbeddings

embeddings = GoogleGenerativeAIEmbeddings(model="models/gemini-embedding-001")
vector = embeddings.embed_query("hello, world!")
vector[:5]
```

```text
[-0.024917153641581535,
 0.012005362659692764,
 -0.003886754624545574,
 -0.05774897709488869,
 0.0020742062479257584]
```

## 批量处理

您也可以一次性嵌入多个字符串以提高处理速度：

```python
vectors = embeddings.embed_documents(
    [
        "Today is Monday",
        "Today is Tuesday",
        "Today is April Fools day",
    ]
)
len(vectors), len(vectors[0])
```

```text
(3, 3072)
```

## 索引与检索

嵌入模型通常用于检索增强生成 (RAG) 流程中，既作为索引数据的一部分，也用于后续检索。更详细的说明，请参阅我们的 [RAG 教程](/oss/langchain/rag)。

下面，我们将展示如何使用上面初始化的 `embeddings` 对象来索引和检索数据。在这个例子中，我们将在 `InMemoryVectorStore` 中索引和检索一个示例文档。

```python
# 使用示例文本创建向量存储
from langchain_core.vectorstores import InMemoryVectorStore

text = "LangChain is the framework for building context-aware reasoning applications"

vectorstore = InMemoryVectorStore.from_texts(
    [text],
    embedding=embeddings,
)

# 将向量存储用作检索器
retriever = vectorstore.as_retriever()

# 检索最相似的文本
retrieved_documents = retriever.invoke("What is LangChain?")

# 显示检索到的文档内容
retrieved_documents[0].page_content
```

```text
'LangChain is the framework for building context-aware reasoning applications'
```

## 任务类型

`GoogleGenerativeAIEmbeddings` 可选地支持一个 `task_type` 参数，当前必须是以下之一：

- `SEMANTIC_SIMILARITY`：用于生成优化以评估文本相似度的嵌入。
- `CLASSIFICATION`：用于生成优化以根据预设标签对文本进行分类的嵌入。
- `CLUSTERING`：用于生成优化以基于相似性对文本进行聚类的嵌入。
- `RETRIEVAL_DOCUMENT`、`RETRIEVAL_QUERY`、`QUESTION_ANSWERING` 和 `FACT_VERIFICATION`：用于生成优化用于文档搜索或信息检索的嵌入。
- `CODE_RETRIEVAL_QUERY`：用于根据自然语言查询（例如对数组排序或反转链表）检索代码块。代码块的嵌入使用 `RETRIEVAL_DOCUMENT` 计算。

默认情况下，我们在 `embed_documents` 方法中使用 `RETRIEVAL_DOCUMENT`，在 `embed_query` 方法中使用 `RETRIEVAL_QUERY`。如果您提供了任务类型，我们将在所有方法中使用该类型。

```python
pip install -qU  matplotlib scikit-learn
```

```python
from langchain_google_genai import GoogleGenerativeAIEmbeddings
from sklearn.metrics.pairwise import cosine_similarity

query_embeddings = GoogleGenerativeAIEmbeddings(
    model="models/gemini-embedding-001", task_type="RETRIEVAL_QUERY"
)
doc_embeddings = GoogleGenerativeAIEmbeddings(
    model="models/gemini-embedding-001", task_type="RETRIEVAL_DOCUMENT"
)

q_embed = query_embeddings.embed_query("What is the capital of France?")
d_embed = doc_embeddings.embed_documents(
    ["The capital of France is Paris.", "Philipp is likes to eat pizza."]
)

for i, d in enumerate(d_embed):
    print(f"Document {i + 1}:")
    print(f"Cosine similarity with query: {cosine_similarity([q_embed], [d])[0][0]}")
    print("---")
```

```text
Document 1
Cosine similarity with query: 0.7892893360164779
---
Document 2
Cosine similarity with query: 0.5438283285204146
---
```

---

## API 参考

有关 `GoogleGenerativeAIEmbeddings` 功能和配置选项的详细文档，请参阅 [API 参考](https://python.langchain.com/api_reference/google_genai/embeddings/langchain_google_genai.embeddings.GoogleGenerativeAIEmbeddings.html)。

## 附加配置

您可以将以下参数传递给 ChatGoogleGenerativeAI 以自定义 SDK 的行为：

- `client_options`：要传递给 Google API 客户端的 [客户端选项](https://googleapis.dev/python/google-api-core/latest/client_options.html#module-google.api_core.client_options)，例如自定义的 `client_options["api_endpoint"]`
- `transport`：要使用的传输方法，例如 `rest`、`grpc` 或 `grpc_asyncio`。
