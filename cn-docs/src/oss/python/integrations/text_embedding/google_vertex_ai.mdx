---
title: VertexAIEmbeddings
---
<Danger>
    **已弃用**

    此集成已被弃用，并将在未来的版本中移除。请改用 [`GoogleGenerativeAIEmbeddings`](/oss/integrations/text_embedding/google_generative_ai)。查看完整的[发布说明和迁移指南](https://github.com/langchain-ai/langchain-google/discussions/1422)。
</Danger>

本文将帮助您开始使用 LangChain 的 Google Vertex AI Embeddings 模型。关于 `Google Vertex AI Embeddings` 功能和配置选项的详细文档，请参阅 [API 参考](https://python.langchain.com/api_reference/google_vertexai/embeddings/langchain_google_vertexai.embeddings.VertexAIEmbeddings.html)。

## 概述

### 集成详情

| 提供商 | 包 |
|:--------:|:-------:|
| [Google](https://python.langchain.com/docs/integrations/providers/google/) | [langchain-google-vertexai](https://python.langchain.com/api_reference/google_vertexai/embeddings/langchain_google_vertexai.embeddings.VertexAIEmbeddings.html) |

## 设置

要访问 Google Vertex AI Embeddings 模型，您需要：

- 创建一个 Google Cloud 账户
- 安装 `langchain-google-vertexai` 集成包。

### 凭证

前往 [Google Cloud](https://cloud.google.com/free/) 注册并创建账户。完成后，设置 `GOOGLE_APPLICATION_CREDENTIALS` 环境变量：

更多信息，请参阅：

[cloud.google.com/docs/authentication/application-default-credentials#GAC](https://cloud.google.com/docs/authentication/application-default-credentials#GAC)
[googleapis.dev/python/google-auth/latest/reference/google.auth.html#module-google.auth](https://googleapis.dev/python/google-auth/latest/reference/google.auth.html#module-google.auth)

**可选：验证您的笔记本环境（仅限 Colab）**

如果您在 Google Colab 上运行此笔记本，请运行下面的单元格来验证您的环境。

```python
import sys

if "google.colab" in sys.modules:
    from google.colab import auth

    auth.authenticate_user()
```

**设置 Google Cloud 项目信息并初始化 Vertex AI SDK**

要开始使用 Vertex AI，您必须拥有一个现有的 Google Cloud 项目并[启用 Vertex AI API](https://console.cloud.google.com/flows/enableapi?apiid=aiplatform.googleapis.com)。

了解更多关于[设置项目和开发环境](https://cloud.google.com/vertex-ai/docs/start/cloud-environment)的信息。

```python
PROJECT_ID = "[your-project-id]"  # @param {type:"string"}
LOCATION = "us-central1"  # @param {type:"string"}

import vertexai

vertexai.init(project=PROJECT_ID, location=LOCATION)
```

要启用模型调用的自动追踪，请设置您的 [LangSmith](https://docs.langchain.com/langsmith/home) API 密钥：

```python
os.environ["LANGSMITH_TRACING"] = "true"
os.environ["LANGSMITH_API_KEY"] = getpass.getpass("Enter your LangSmith API key: ")
```

### 安装

LangChain Google Vertex AI Embeddings 集成位于 `langchain-google-vertexai` 包中：

```python
pip install -qU langchain-google-vertexai
```

## 实例化

现在我们可以实例化我们的模型对象并生成嵌入向量：
> 查看[支持的模型](https://cloud.google.com/vertex-ai/generative-ai/docs/embeddings/get-text-embeddings#supported-models)列表

```python
from langchain_google_vertexai import VertexAIEmbeddings

# 初始化特定的 Embeddings 模型版本
embeddings = VertexAIEmbeddings(model_name="gemini-embedding-001")
```

## 索引与检索

嵌入模型通常用于检索增强生成（RAG）流程中，既作为索引数据的一部分，也用于后续检索。更详细的说明，请参阅我们的 [RAG 教程](/oss/langchain/rag)。

下面，我们将展示如何使用上面初始化的 `embeddings` 对象来索引和检索数据。在这个例子中，我们将在 `InMemoryVectorStore` 中索引和检索一个示例文档。

```python
# 使用示例文本创建向量存储
from langchain_core.vectorstores import InMemoryVectorStore

text = "LangChain is the framework for building context-aware reasoning applications"

vectorstore = InMemoryVectorStore.from_texts(
    [text],
    embedding=embeddings,
)

# 将向量存储用作检索器
retriever = vectorstore.as_retriever()

# 检索最相似的文本
retrieved_documents = retriever.invoke("What is LangChain?")

# 显示检索到的文档内容
retrieved_documents[0].page_content
```

```text
'LangChain is the framework for building context-aware reasoning applications'
```

## 直接使用

在底层，向量存储和检索器的实现会调用 `embeddings.embed_documents(...)` 和 `embeddings.embed_query(...)`，分别为 `from_texts` 中使用的文本和检索 `invoke` 操作创建嵌入向量。

您可以直接调用这些方法来获取用于您自己用例的嵌入向量。

### 嵌入单个文本

您可以使用 `embed_query` 嵌入单个文本或文档：

```python
single_vector = embeddings.embed_query(text)
print(str(single_vector)[:100])  # 显示向量的前 100 个字符
```

```text
[-0.02831101417541504, 0.022063178941607475, -0.07454229146242142, 0.006448323838412762, 0.001955120
```

### 嵌入多个文本

您可以使用 `embed_documents` 嵌入多个文本：

```python
text2 = (
    "LangGraph is a library for building stateful, multi-actor applications with LLMs"
)
two_vectors = embeddings.embed_documents([text, text2])
for vector in two_vectors:
    print(str(vector)[:100])  # 显示向量的前 100 个字符
```

```text
[-0.01092718355357647, 0.01213780976831913, -0.05650627985596657, 0.006737854331731796, 0.0085973171
[0.010135706514120102, 0.01234869472682476, -0.07284046709537506, 0.00027134662377648056, 0.01546290
```

---

## API 参考

关于 `Google Vertex AI Embeddings` 功能和配置选项的详细文档，请参阅 [API 参考](https://python.langchain.com/api_reference/google_vertexai/embeddings/langchain_google_vertexai.embeddings.VertexAIEmbeddings.html)。
