---
title: MariaDB
---
LangChain 的 MariaDB 集成（langchain-mariadb）为 MariaDB 11.7.1 及以上版本提供了向量功能，该集成在 MIT 许可证下分发。用户可以直接使用提供的实现，也可以根据特定需求进行定制。

主要功能包括：

*   内置向量相似性搜索
*   支持余弦和欧几里得距离度量
*   强大的元数据过滤选项
*   通过连接池进行性能优化
*   可配置的表和列设置

## 安装

使用以下命令启动 MariaDB Docker 容器：

```python
!docker run --name mariadb-container -e MARIADB_ROOT_PASSWORD=langchain -e MARIADB_DATABASE=langchain -p 3306:3306 -d mariadb:11.7
```

### 安装包

该包使用 SQLAlchemy，但与 MariaDB 连接器配合使用效果最佳，后者需要 C/C++ 组件：

```python
# Debian, Ubuntu
!sudo apt install libmariadb3 libmariadb-dev

# CentOS, RHEL, Rocky Linux
!sudo yum install MariaDB-shared MariaDB-devel

# 安装 Python 连接器
!pip install -U mariadb
```

然后安装 `langchain-mariadb` 包

```python
pip install -U langchain-mariadb

```

VectorStore 需要与 LLM 模型配合使用，这里以 `langchain-openai` 为例。

```python
pip install langchain-openai
export OPENAI_API_KEY=...

```

## 初始化

```python
from langchain_core.documents import Document
from langchain_mariadb import MariaDBStore
from langchain_openai import OpenAIEmbeddings

# 连接字符串
url = f"mariadb+mariadbconnector://myuser:mypassword@localhost/langchain"

# 初始化向量存储
vectorstore = MariaDBStore(
    embeddings=OpenAIEmbeddings(),
    embedding_length=1536,
    datasource=url,
    collection_name="my_docs",
)
```

## 管理向量存储

### 添加数据

您可以添加带有元数据的文档数据：

```python
docs = [
    Document(
        page_content="there are cats in the pond",
        metadata={"id": 1, "location": "pond", "topic": "animals"},
    ),
    Document(
        page_content="ducks are also found in the pond",
        metadata={"id": 2, "location": "pond", "topic": "animals"},
    ),
    # 更多文档...
]
vectorstore.add_documents(docs)
```

或者添加纯文本及可选的元数据：

```python
texts = [
    "a sculpture exhibit is also at the museum",
    "a new coffee shop opened on Main Street",
]
metadatas = [
    {"id": 6, "location": "museum", "topic": "art"},
    {"id": 7, "location": "Main Street", "topic": "food"},
]

vectorstore.add_texts(texts=texts, metadatas=metadatas)
```

## 查询向量存储

```python
# 基本相似性搜索
results = vectorstore.similarity_search("Hello", k=2)

# 带元数据过滤的搜索
results = vectorstore.similarity_search("Hello", filter={"category": "greeting"})
```

### 过滤选项

系统支持对元数据进行多种过滤操作：

*   相等：$eq
*   不相等：$ne
*   比较：$lt, $lte, $gt, $gte
*   列表操作：$in, $nin
*   文本匹配：$like, $nlike
*   逻辑操作：$and, $or, $not

示例：

```python
# 使用简单过滤器搜索
results = vectorstore.similarity_search(
    "kitty", k=10, filter={"id": {"$in": [1, 5, 2, 9]}}
)

# 使用多个条件（AND）搜索
results = vectorstore.similarity_search(
    "ducks",
    k=10,
    filter={"id": {"$in": [1, 5, 2, 9]}, "location": {"$in": ["pond", "market"]}},
)
```

---

## API 参考

更多详细信息，请参阅仓库 [此处](https://github.com/mariadb-corporation/langchain-mariadb)。
