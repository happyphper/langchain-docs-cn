---
title: 概述
sidebarTitle: Overview
---


本概述涵盖了 LangSmith 中管理用户、组织、工作区和应用程序的相关主题。

## 资源层级结构

### 组织

组织是 LangSmith 内用户的一个逻辑分组，它定义了应用于其所有工作区的共享设置。这些设置管理的是组织范围的事务，而非工作区内的单个项目。常见的组织级配置包括用户管理、单点登录（SSO）、OAuth 提供商配置、自定义角色创建、计费和使用情况跟踪。通常，每个公司有一个组织。一个组织可以拥有多个工作区。更多详情，请参阅[设置指南](/langsmith/set-up-hierarchy#set-up-an-organization)。

首次登录时，系统会自动为您创建一个个人组织。如果您想与他人协作，可以创建一个单独的组织并邀请您的团队成员加入。个人组织和共享组织之间存在一些重要区别：

| 功能特性         | 个人组织          | 共享组织                                                                                     |
| ---------------- | ----------------- | -------------------------------------------------------------------------------------------- |
| 最大工作区数量   | 1                 | 可变，取决于计划（参见[定价页面](https://www.langchain.com/pricing-langsmith)）              |
| 协作             | 无法邀请用户      | 可以邀请用户                                                                                 |
| 计费：付费计划   | 仅限开发者计划    | 所有其他计划均可用                                                                           |

### 工作区

<Info>

工作区以前称为租户。在过渡期间，部分代码和 API 可能仍会在一段时间内引用旧名称。

</Info>

工作区是组织内用户和资源的逻辑分组。工作区通常用于隔离团队或业务部门，提供项目及其关联资源之间的分离。工作区为资源和访问控制划分了信任边界。用户在**工作区级别**被授予权限，这些权限决定了他们对该工作区内资源的访问权限，包括追踪项目、数据集、标注队列和提示。有关设置的详细信息，请参阅[设置指南](/langsmith/set-up-hierarchy#set-up-a-workspace)；有关权限的详细信息，请参阅[工作区（RBAC）](/langsmith/administration-overview#workspace-roles-rbac)。

建议为组织内的每个团队创建一个单独的工作区。为了进一步组织资源，您可以使用[应用程序](#applications)对工作区内的资源进行分组。有关根据团队隔离需求的不同工作区组织模型的指导，请参阅[工作负载隔离](/langsmith/workload-isolation)。

下图显示了一个示例工作区设置页面：![示例工作区](/langsmith/images/sample-workspace.png)

### 应用程序

应用程序是工作区内资源的逻辑分组。应用程序通常是智能体（agent），但也可以用于团队内的任何项目。应用程序通过仅显示与当前上下文中的应用程序关联的资源，来保持用户界面的条理性。

应用程序建立在[资源标签](/langsmith/administration-overview#resource-tags)之上，并可用于通过[ABAC（目前处于私有预览阶段）](/langsmith/organization-workspace-operations#access-policies)来控制资源访问。

下图显示了如何在主导航栏中管理和切换应用程序：![示例应用程序选择器](/langsmith/images/sample-application-selector.png)

任何资源都可以在不与应用程序关联的情况下创建。当选择`显示所有应用程序`选项时，这些资源将可见。

### 资源

资源是用于构建、运行和观察应用程序与智能体（agent）的具体实体，例如追踪项目、提示词、数据集和部署。资源的作用域限定于特定的应用程序。

### 附加信息

下图解释了组织、工作空间、应用程序和资源之间的关系：![资源层级结构](/langsmith/images/resource-hierarchy.png)

有关哪些功能在哪些作用域中可用的详细信息，请参见下表：

| 资源/设置                                                                   | 作用域           |
| --------------------------------------------------------------------------- | ---------------- |
| 追踪项目                                                              | 工作空间或应用程序        |
| 标注队列                                                           | 工作空间或应用程序        |
| 部署                                                                 | 工作空间或应用程序        |
| 数据集与实验                                                      | 工作空间或应用程序        |
| 提示词                                                                     | 工作空间或应用程序        |
| 资源标签                                                               | 工作空间                       |
| API 密钥                                                                    | 工作空间                       |
| 设置（包括密钥、反馈配置、模型、规则和共享 URL） | 工作空间                       |
| 用户管理：邀请用户到工作空间                                   | 工作空间                       |
| RBAC：分配工作空间角色                                             | 工作空间                       |
| 数据保留、使用限制                                                | 工作空间\*                     |
| 计划与计费、积分、发票                                        | 组织                    |
| 用户管理：邀请用户到组织                                | 组织\*\*                |
| 添加工作空间                                                           | 组织                    |
| 分配组织角色                                                | 组织                    |
| RBAC：创建/编辑/删除自定义角色                                | 组织                    |

\* 数据保留设置和使用限制也即将在组织级别可用。\*\* 自托管安装可以通过功能标志启用工作空间级别的用户邀请到组织。详情请参阅[自托管用户管理文档](/langsmith/self-host-user-management)。

### 资源标签

资源标签允许您在工作空间内进一步隔离资源，以便与[ABAC](/langsmith/organization-workspace-operations#access-policies)一起使用。每个标签都是一个可以分配给资源的键值对。

LangSmith 的资源标签与[AWS](https://docs.aws.amazon.com/tag-editor/latest/userguide/tagging.html)等云服务中的标签非常相似。

![示例资源标签](/langsmith/images/resource-tags.png)

## 用户管理与 RBAC

### 用户

用户是指有权访问 LangSmith 的人员。用户可以是一个或多个组织的成员，也可以是这些组织内一个或多个工作空间的成员。

组织成员在组织设置中进行管理：

![示例组织成员](/langsmith/images/org-members-settings.png)

而工作空间成员在工作空间设置中进行管理：

![示例工作空间成员](/langsmith/images/org-settings-workspaces-tab.png)

### API 密钥

<Warning>

我们已于 2024 年 10 月 22 日停止支持以 `ls__` 为前缀的旧版 API 密钥，转而支持个人访问令牌（PAT）和服务密钥。我们要求所有新集成都使用 PAT 和服务密钥。自 2024 年 10 月 22 日起，以 `ls__` 为前缀的 API 密钥将不再有效。

</Warning>

#### 过期日期

创建 API 密钥时，您可以选择设置过期日期。为密钥添加过期日期可以增强安全性，并降低未经授权访问的风险。例如，您可以为需要提升访问权限的临时任务设置密钥的过期日期。

默认情况下，密钥永不过期。一旦过期，API 密钥将失效，无法重新激活或修改其过期日期。

#### 个人访问令牌（PAT）

个人访问令牌（PAT）用于对 LangSmith API 的请求进行身份验证。它们由用户创建，并限定于该用户。PAT 将拥有与创建它的用户相同的权限。我们建议不要使用它们来验证来自您应用程序的请求，而是将其用于与 LangSmith API 交互的个人脚本或工具。如果与 PAT 关联的用户从组织中移除，该 PAT 将不再有效。

PAT 的前缀为 `lsv2_pt_`

#### 服务密钥

服务密钥类似于 PAT，但用于代表服务账户对 LangSmith API 的请求进行身份验证。只有管理员可以创建服务密钥。我们建议将其用于需要与 LangSmith API 交互的应用程序/服务，例如 LangGraph 智能体（agent）或其他集成。服务密钥可以限定于单个工作区、多个工作区或整个组织，并可用于对其有权访问的任何工作区的 LangSmith API 请求进行身份验证。

服务密钥的前缀为 `lsv2_sk_`

<Warning>

使用 `X-Tenant-Id` 请求头来指定目标工作区。

*   <strong>使用 PAT 时</strong>：如果省略此请求头，请求将针对与该密钥关联的默认工作区运行。
*   <strong>使用组织范围的服务密钥时</strong>：访问工作区范围的资源时，必须包含 `X-Tenant-Id` 请求头。如果没有，请求将失败并返回 `403 Forbidden` 错误。

</Warning>

<Note>

要了解如何创建服务密钥或个人访问令牌，请参阅[设置指南](/langsmith/create-account-api-key)

</Note>

### 组织角色

组织角色与[企业功能工作区 RBAC](#workspace-roles-rbac) 不同，用于多个[工作区](#workspaces)的上下文中。您的组织角色决定了您的工作区成员资格特性以及您的[组织级权限](/langsmith/organization-workspace-operations)。

所选的组织角色也会影响工作区成员资格，具体如下所述：

*   [组织管理员](/langsmith/rbac#organization-admin) 授予管理所有组织配置、用户、账单和工作区的完全访问权限。
    *   组织管理员对组织中的所有工作区拥有 `Admin` 访问权限。
*   [组织用户](/langsmith/rbac#organization-user) 可以读取组织信息，但无法在组织级别执行任何写入操作。组织用户可以创建[个人访问令牌](#personal-access-tokens-pats)。
    *   组织用户可以添加到一部分工作区中，并像往常一样分配工作区角色（如果启用了 RBAC），这些角色指定了工作区级别的权限。
*   [组织查看者](/langsmith/rbac#organization-viewer) 等同于组织用户，但**不能**创建个人访问令牌。（对于自托管版本，在 Helm chart 版本 0.11.25+ 中可用）。

<Info>

<!--@include: @/snippets/python/langsmith/multi-workspace-org-roles.md-->

有关如何为整个组织禁用 PAT 创建的说明，请参阅[安全设置](/langsmith/manage-organization-by-api#security-settings)。

</Info>

有关设置组织和工作区的更多信息，请参阅[组织设置指南](/langsmith/set-up-hierarchy#organization-roles)以获取详细信息。

下表概述了组织级别的权限：

|                                             | 组织查看者 | 组织用户 | 组织管理员 |
| ------------------------------------------- | ---------- | -------- | ---------- |
| 查看组织配置                                | ✅         | ✅       | ✅         |
| 查看组织角色                                | ✅         | ✅       | ✅         |
| 查看组织成员                                | ✅         | ✅       | ✅         |
| 查看数据保留设置                            | ✅         | ✅       | ✅         |
| 查看使用限制                                | ✅         | ✅       | ✅         |
| 创建个人访问令牌 (PATs)                     | ❌         | ✅       | ✅         |
| 对所有工作区的管理员访问权限                | ❌         | ❌       | ✅         |
| 管理账单设置                                | ❌         | ❌       | ✅         |
| 创建工作区                                  | ❌         | ❌       | ✅         |
| 创建、编辑和删除组织角色                    | ❌         | ❌       | ✅         |
| 邀请新用户加入组织                          | ❌         | ❌       | ✅         |
| 删除用户邀请                                | ❌         | ❌       | ✅         |
| 从组织中移除用户                            | ❌         | ❌       | ✅         |
| 更新数据保留设置                            | ❌         | ❌       | ✅         |
| 更新使用限制                                | ❌         | ❌       | ✅         |

<!--@include: @/snippets/python/langsmith/permissions-reference.md-->

### 工作区角色 (RBAC)

<Note>

RBAC（基于角色的访问控制）是一项仅面向企业客户的功能。如果您对此功能感兴趣，请[联系我们的销售团队](https://www.langchain.com/contact-sales)。其他计划默认对所有用户使用管理员角色。

</Note>

角色用于定义用户在某个工作区内拥有的权限集。有三个无法编辑的内置系统角色：

- [工作区管理员](/langsmith/rbac#workspace-admin) 拥有对工作区内所有资源的完全访问权限。
- [工作区编辑者](/langsmith/rbac#workspace-editor) 拥有除工作区管理（添加/移除用户、更改角色、配置服务密钥）外的所有权限。
- [工作区查看者](/langsmith/rbac#workspace-viewer) 拥有对工作区内所有资源的只读访问权限。

[组织管理员](/langsmith/rbac#organization-admin) 还可以为不同资源创建/编辑具有特定权限的自定义角色。

可以在 **组织设置** 下的 **角色** 选项卡中管理角色：

![显示角色列表的组织成员和角色视图。](/langsmith/images/roles-tab-rbac.png)

- 有关角色和权限的完整文档，请参阅[基于角色的访问控制](/langsmith/rbac)指南。
- 有关分配和创建角色的更多详细信息，请参阅[用户管理](/langsmith/user-management)指南。
- <!--@include: @/snippets/python/langsmith/permissions-reference.md-->

## 最佳实践

### 环境分离

使用[资源标签](#resource-tags)，通过默认标签键 `Environment` 和不同的环境值（例如 `dev`、`staging`、`prod`）来按环境组织资源。我们不建议使用独立的工作空间进行环境分离，因为资源无法跨工作空间共享，这会阻碍您在环境之间提升资源（如提示词）。

<Note>

<strong>提示词管理中的资源标签与提交标签</strong>

虽然两种类型的标签都可以使用 `dev`、`staging` 和 `prod` 等环境术语，但它们的目的不同：

- <strong>资源标签</strong> (`Environment: prod`)：使用这些标签在您的工作空间内*组织和筛选*资源。将资源标签应用于追踪项目、数据集和其他资源（包括提示词），以按环境对它们进行分组，从而在用户界面中实现筛选。
- [提交标签](/langsmith/manage-prompts#commit-tags) (`prod` 标签)：使用这些标签来管理您的代码引用的[提示词版本](/langsmith/prompt-engineering)。提交标签是指向提示词历史记录中特定提交的标签。当您的代码按标签名称拉取提示词时（例如 `client.pull_prompt("prompt-name:prod")`），它会检索该标签当前指向的提交。要将提示词从 `staging` 提升到 `prod`，请移动提交标签以指向所需的版本。

资源标签组织<strong>哪些资源</strong>属于某个环境。提交标签让您可以控制代码引用的提示词的<strong>哪个版本</strong>，而无需更改代码本身。

</Note>

## 使用与计费

### 数据保留

本节介绍 LangSmith 中数据保留的工作原理及其定价方式。

#### 保留的重要性

* **隐私**：许多数据隐私法规，例如欧洲的 GDPR 或加利福尼亚州的 CCPA，要求组织在个人数据不再为收集目的所需时将其删除。设置保留期限有助于遵守此类法规。
* **成本**：LangSmith 对数据保留期短的追踪收费较低。有关详细信息，请参阅我们关于如何[优化支出](/langsmith/billing#optimize-your-tracing-spend)的教程。

#### 工作原理

LangSmith 根据数据保留将追踪分为两个层级，具有以下特点：

|                      | 基础层             | 扩展层       |
| -------------------- | ---------------- | -------------- |
| **价格**            | $.50 / 千次追踪 | $5 / 千次追踪 |
| **保留期限** | 14 天          | 400 天       |

**保留期结束后的数据删除**

在指定的保留期结束后，追踪将无法在追踪项目用户界面或通过 API 访问。与该追踪相关的所有用户数据（例如输入和输出）将在其后一天内从我们的内部系统中删除。出于分析和计费目的，与每次追踪相关的某些元数据可能会无限期保留。

**数据保留自动升级**

<Warning>

自动升级可能会影响您的账单。请仔细阅读本节，以充分了解您预估的 LangSmith 追踪成本。

</Warning>

当您对 `基础层` 追踪使用某些功能时，其数据保留将自动升级到 `扩展层`。这将同时增加保留期限和追踪成本。

在以下场景中，追踪将自动升级：

* 向追踪（或线程中的任何追踪）上的任何运行添加**反馈**时，无论是通过[手动标注](/langsmith/annotate-traces-inline#annotate-traces-and-runs-inline)、使用[在线评估器](/langsmith/online-evaluations)自动添加，还是通过 SDK 以编程方式[添加](/langsmith/attach-user-feedback#log-user-feedback-using-the-sdk)。
* **[标注队列](/langsmith/annotation-queues#assign-runs-to-an-annotation-queue)** 收到来自追踪的任何运行时。
* **[自动化规则](/langsmith/rules#set-up-automation-rules)** 匹配追踪内的任何运行时。

**为何自动升级追踪？**

我们为追踪设置自动升级模型有两个原因：

1. 我们认为符合以下任一条件的追踪从根本上比其他追踪更有价值，因此让用户能够更长时间地保留这些追踪是有益的。
2. 从理念上讲，我们希望为那些可能没有进行有意义交互的追踪收取低一个数量级的费用。我们认为自动升级使我们的定价模式与 LangSmith 带来的价值保持一致，即只有具有有意义交互的追踪才会按更高的费率收费。

如果您对我们的定价模式有任何疑问或顾虑，请随时通过 [support.langchain.com](https://support.langchain.com) 联系支持团队并告诉我们您的想法！

**数据保留如何影响下游功能？**

*   **标注队列、运行规则和反馈**：使用这些功能的追踪将被[自动升级](#data-retention-auto-upgrades)。
*   **监控**：即使在基础层级追踪的数据保留期结束后，监控选项卡仍将继续工作。它由存在超过 30 天的追踪元数据提供支持，这意味着即使在 `base` 层级的追踪上，您的监控图表也将继续保持准确。
*   **数据集**：数据集具有无限期的数据保留期。换句话说，如果您将追踪的输入和输出添加到数据集中，它们将永远不会被删除。我们建议，如果您使用 LangSmith 进行数据收集，请充分利用数据集功能。

#### 计费模式

**可计费指标**

在您的 LangSmith 账单上，您将看到我们收取费用的两个指标：

*   LangSmith 追踪（基础费用）
*   LangSmith 追踪（延长数据保留升级）。

第一个指标包括所有追踪，无论其层级如何。第二个指标仅计算延长保留期追踪的数量。

**为什么衡量所有追踪 + 升级，而不是直接衡量基础追踪和延长保留期追踪？**

在考虑我们的定价时，一个很自然的问题是：为什么不在账单上直接显示 `base` 层级和 `extended` 层级追踪的数量？

虽然我们理解这样做会更直接，但它不能恰当地适应追踪升级的情况。考虑一个在 6 月 30 日记录的 `base` 层级追踪，并在 7 月 3 日升级到 `extended` 层级。`base` 层级追踪发生在 6 月的计费周期，但升级发生在 7 月的计费周期。因此，我们需要能够独立衡量这两个事件，以便正确地向客户收费。

如果您的追踪是作为延长保留期追踪记录的，那么 `base` 和 `extended` 指标将使用相同的时间戳记录。

**成本细分**

每个追踪的基础费用为 0.05 美分。我们对升级的定价是，一个 `extended` 保留期追踪的成本是基础层级追踪价格的 10 倍（每个追踪 0.50 美分），包括两个指标。因此，每次升级的费用为 0.45 美分。

### 速率限制

LangSmith 设有速率限制，旨在确保所有用户的服务稳定性。

为确保访问和稳定性，在以下情况下，LangSmith 将返回 HTTP 状态码 429，表示已超过速率或使用限制：

#### 在我们的应用负载均衡器上，超过 1 分钟内的临时吞吐量限制

此 429 是由于在 1 分钟窗口内，基于每个 API 密钥/访问令牌，超过了固定的 API 调用次数。窗口的开始时间会略有不同——不保证从整分钟开始——并且可能会根据应用部署事件而变化。

在收到最大事件数后，我们将返回 429 响应，直到从评估窗口开始算起达到 60 秒，然后该过程重复。

此 429 由我们的应用负载均衡器抛出，是为所有 LangSmith 用户（无论计划层级）设立的一种机制，以确保所有用户服务的连续性。

| 方法            | 端点          | 限制  | 窗口     |
| ----------------- | ------------- | ----- | -------- |
| `DELETE`          | `/sessions*`  | 30    | 1 分钟   |
| `POST` 或 `PATCH` | `/runs*`      | 5000  | 1 分钟   |
| `GET`             | `/runs/:id`   | 30    | 1 分钟   |
| `POST`            | `/feedbacks*` | 5000  | 1 分钟   |
| `*`               | `*`           | 2000  | 1 分钟   |

<Note>

LangSmith SDK 会采取措施，通过将来自同一会话 ID 的至多 100 次运行批量处理为单个 API 调用，来最大程度地降低达到运行相关端点这些限制的可能性。

</Note>

#### 计划级别的每小时追踪事件限制

此 429 错误是由于达到您每小时最大事件摄入量所致，评估窗口为固定窗口，从每个 UTC 整点开始，并在每个新整点重置。

在此上下文中，事件指的是运行的创建或更新。因此，如果一个运行被创建，随后在同一小时内被更新，这将计为此限制下的 2 个事件。

此错误由我们的应用程序抛出，并因计划层级而异。我们为初创/增强版和企业版计划层级设计的组织拥有比免费版和开发者版计划层级更高的每小时限制，后者专为个人使用设计。

| 计划                             | 限制           | 窗口   |
| -------------------------------- | -------------- | ------ |
| 开发者版（无付款记录）           | 50,000 个事件  | 1 小时 |
| 开发者版（有付款记录）           | 250,000 个事件 | 1 小时 |
| 初创/增强版                      | 500,000 个事件 | 1 小时 |
| 企业版                           | 自定义         | 自定义 |

#### 计划级别的每小时追踪数据摄入限制

此 429 错误是由于达到您的追踪输入、输出和元数据总数据摄入量上限所致，评估窗口为固定窗口，从每个 UTC 整点开始，并在每个新整点重置。

通常，输入、输出和元数据会在运行创建和更新事件时发送。因此，如果一个运行被创建时大小为 2.0MB，并在同一小时内更新后大小为 3.0MB，这将计为此限制下的 5.0MB 存储量。

此错误由我们的应用程序抛出，并因计划层级而异。我们为初创/增强版和企业版计划层级设计的组织拥有比免费版和开发者版计划层级更高的每小时限制，后者专为个人使用设计。

| 计划                             | 限制  | 窗口   |
| -------------------------------- | ----- | ------ |
| 开发者版（无付款记录）           | 500MB | 1 小时 |
| 开发者版（有付款记录）           | 2.5GB | 1 小时 |
| 初创/增强版                      | 5.0GB | 1 小时 |
| 企业版                           | 自定义 | 自定义 |

#### 计划级别的每月唯一追踪限制

此 429 错误是由于达到您每月最大追踪摄入量所致，评估窗口为固定窗口，从每个日历月的 UTC 月初开始，并在每个新月初重置。

此错误由我们的应用程序抛出，并且仅适用于无付款记录时的开发者版计划层级。

| 计划                           | 限制         | 窗口    |
| ------------------------------ | ------------ | ------- |
| 开发者版（无付款记录）         | 5,000 条追踪 | 1 个月  |

#### 自行配置的每月使用量限制

此 429 错误是由于达到您组织管理员配置的使用量限制所致，评估窗口为固定窗口，从每个日历月的 UTC 月初开始，并在每个新月初重置。

此错误由我们的应用程序抛出，并根据组织的配置设置而异。

#### 在您的应用程序中处理 429 响应

由于某些 429 响应是暂时的，可能在后续调用中成功，如果您在应用程序中直接调用 LangSmith API，我们建议实施带有指数退避和抖动的重试逻辑。

为了方便，使用 LangSmith SDK 构建的 LangChain 应用程序已内置此功能。

<Note>

需要注意的是，如果您长时间使端点处于饱和状态，重试可能不会有效，因为您的应用程序最终会积累足够大的积压任务，耗尽所有重试次数。

如果是这种情况，我们希望更具体地讨论您的需求。请通过 [LangSmith 支持](https://support.langchain.com) 联系支持团队，提供有关您应用程序吞吐量需求的详细信息以及示例代码，我们可以与您合作，更好地了解最佳方法是修复错误、更改应用程序代码还是选择不同的 LangSmith 计划。

</Note>

### 使用限制

LangSmith 允许您配置跟踪的使用限制。请注意，这些是*使用*限制，而不是*支出*限制，这意味着它们允许您限制某些事件的发生次数，而不是您将花费的总金额。

LangSmith 允许您设置两种不同的月度限制，这反映了我们在前述数据保留指南中讨论的可计费指标：

* 所有跟踪限制
* 扩展数据保留跟踪限制

这些限制分别允许您限制总跟踪数和扩展数据保留跟踪数。

#### 使用限制的特性

使用限制是近似值，这意味着我们不保证限制的精确性。在极少数情况下，可能在应用使用限制之前，会有少量额外跟踪在超过限制阈值后被处理。

#### 扩展数据保留跟踪限制的副作用

扩展数据保留跟踪限制有副作用。如果已达到限制，任何可能导致跟踪层级自动升级的功能将变得不可访问。这是因为跟踪的自动升级将导致创建另一个扩展保留跟踪，而这反过来不应被限制允许。因此，您将无法：

1. 匹配运行规则
2. 向跟踪添加反馈
3. 将运行添加到注释队列

这些功能中的每一个都可能导致自动升级，因此当达到限制时，我们会关闭它们。

#### 更新使用限制

使用限制可以从 `设置` 页面下的 `使用与计费` 中更新。限制值会被缓存，因此新限制可能需要一两分钟才能生效。

### 相关内容

* 关于如何[优化支出](/langsmith/billing#optimize-your-tracing-spend)的教程

## 其他资源

* **[发布版本](/langsmith/release-versions)**：了解 LangSmith 的版本支持政策，包括活跃、关键、生命周期结束和已弃用的支持级别。
