---
title: Zep Cloud 检索器
---
> [Zep](https://www.getzep.com) 是一个面向 AI 助手应用的长时记忆服务。
> 借助 Zep，您可以为 AI 助手提供回忆过往对话的能力，无论对话发生在多久以前，
> 同时还能减少幻觉、降低延迟和成本。

本示例展示了如何在检索链中使用 Zep 检索器，从 Zep 开源记忆存储中检索文档。

## 安装

注册 [Zep Cloud](https://app.getzep.com/) 并创建一个项目。

按照 [Zep Cloud Typescript SDK 安装指南](https://help.getzep.com/sdks) 进行安装并开始使用 Zep。

您需要 Zep Cloud 项目 API 密钥才能使用 ZepCloudRetriever。更多信息请参阅 [Zep Cloud 文档](https://help.getzep.com/projects)。

## 设置

<Tip>

有关安装 LangChain 包的通用说明，请参阅 [此部分](/oss/javascript/langchain/install)。

</Tip>

```bash [npm]
npm i @getzep/zep-cloud @langchain/community @langchain/core
```

## 用法

```typescript
import { ZepCloudRetriever } from "@langchain/community/retrievers/zep_cloud";
import { randomUUID } from "crypto";
import { ZepClient, type Zep } from "@getzep/zep-cloud";

function sleep(ms: number) {
  // eslint-disable-next-line no-promise-executor-return
  return new Promise((resolve) => setTimeout(resolve, ms));
}

const zepConfig = {
  // 您的 Zep Cloud 项目 API 密钥 https://help.getzep.com/projects
  apiKey: "<Zep Api Key>",
  sessionId: `session_${randomUUID()}`,
};

console.log(`Zep Config: ${JSON.stringify(zepConfig)}`);

// 生成关于去法国旅行的聊天消息
const chatMessages = [
  {
    role: "AI",
    message: "Bonjour! How can I assist you with your travel plans today?",
  },
  { role: "User", message: "I'm planning a trip to France." },
  {
    role: "AI",
    message: "That sounds exciting! What cities are you planning to visit?",
  },
  { role: "User", message: "I'm thinking of visiting Paris and Nice." },
  {
    role: "AI",
    message: "Great choices! Are you interested in any specific activities?",
  },
  { role: "User", message: "I would love to visit some vineyards." },
  {
    role: "AI",
    message:
      "France has some of the best vineyards in the world. I can help you find some.",
  },
  { role: "User", message: "That would be great!" },
  { role: "AI", message: "Do you prefer red or white wine?" },
  { role: "User", message: "I prefer red wine." },
  {
    role: "AI",
    message:
      "Perfect! I'll find some vineyards that are known for their red wines.",
  },
  { role: "User", message: "Thank you, that would be very helpful." },
  {
    role: "AI",
    message:
      "You're welcome! I'll also look up some French wine etiquette for you.",
  },
  {
    role: "User",
    message: "That sounds great. I can't wait to start my trip!",
  },
  {
    role: "AI",
    message:
      "I'm sure you'll have a fantastic time. Do you have any other questions about your trip?",
  },
  { role: "User", message: "Not at the moment, thank you for your help!" },
];

const zepClient = new ZepClient({
  apiKey: zepConfig.apiKey,
});

// 将聊天消息添加到记忆
for (const chatMessage of chatMessages) {
  let m: Zep.Message;
  if (chatMessage.role === "AI") {
    m = { role: "ai", roleType: "assistant", content: chatMessage.message };
  } else {
    m = { role: "human", roleType: "user", content: chatMessage.message };
  }

  await zepClient.memory.add(zepConfig.sessionId, { messages: [m] });
}

// 等待消息被总结、丰富、嵌入和索引。
await sleep(10000);

// 简单相似性搜索
const query = "Can I drive red cars in France?";
const retriever = new ZepCloudRetriever({ ...zepConfig, topK: 3 });
const docs = await retriever.invoke(query);
console.log("Simple similarity search");
console.log(JSON.stringify(docs, null, 2));

// MMR 重排序搜索
const mmrRetriever = new ZepCloudRetriever({
  ...zepConfig,
  topK: 3,
  searchType: "mmr",
  mmrLambda: 0.5,
});
const mmrDocs = await mmrRetriever.invoke(query);
console.log("MMR reranking search");
console.log(JSON.stringify(mmrDocs, null, 2));

// 摘要搜索配合 MMR 重排序
const mmrSummaryRetriever = new ZepCloudRetriever({
  ...zepConfig,
  topK: 3,
  searchScope: "summary",
  searchType: "mmr",
  mmrLambda: 0.5,
});
const mmrSummaryDocs = await mmrSummaryRetriever.invoke(query);
console.log("Summary search with MMR reranking");
console.log(JSON.stringify(mmrSummaryDocs, null, 2));

// 带过滤器的搜索
const filteredRetriever = new ZepCloudRetriever({
  ...zepConfig,
  topK: 3,
  filter: {
    where: { jsonpath: '$[*] ? (@.foo == "bar")' },
  },
});
const filteredDocs = await filteredRetriever.invoke(query);
console.log("Filtered search");
console.log(JSON.stringify(filteredDocs, null, 2));
```

## 相关链接

- [检索指南](/oss/javascript/langchain/retrieval)
