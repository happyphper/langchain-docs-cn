---
title: Prolog
---
使用 Prolog 规则生成答案的 LangChain 工具。

## 概述

PrologTool 类允许生成使用 Prolog 规则来生成答案的 LangChain 工具。

## 设置

让我们使用文件 family.pl 中的以下 Prolog 规则：

parent(john, bianca, mary).\
parent(john, bianca, michael).\
parent(peter, patricia, jennifer).\
partner(X, Y) :- parent(X, Y, _).

```python
#!pip install langchain-prolog

from langchain_prolog import PrologConfig, PrologRunnable, PrologTool

TEST_SCRIPT = "family.pl"
```

## 实例化

首先创建 Prolog 工具：

```python
schema = PrologRunnable.create_schema("parent", ["men", "women", "child"])
config = PrologConfig(
    rules_file=TEST_SCRIPT,
    query_schema=schema,
)
prolog_tool = PrologTool(
    prolog_config=config,
    name="family_query",
    description="""
        使用 Prolog 查询家庭关系。
        parent(X, Y, Z) 仅表示 Z 是 X 和 Y 的孩子。
        输入可以是查询字符串，如 'parent(john, X, Y)' 或 'john, X, Y'"
        您必须指定 3 个参数：men, woman, child。不要使用引号。
    """,
)
```

## 调用

### 将 Prolog 工具与 LLM 和函数调用结合使用

```python
#!pip install python-dotenv

from dotenv import find_dotenv, load_dotenv

load_dotenv(find_dotenv(), override=True)

#!pip install langchain-openai

from langchain.messages import HumanMessage
from langchain_openai import ChatOpenAI
```

要使用该工具，请将其绑定到 LLM 模型：

```python
model = ChatOpenAI(model="gpt-4o-mini")
model_with_tools = model.bind_tools([prolog_tool])
```

然后查询模型：

```python
query = "Who are John's children?"
messages = [HumanMessage(query)]
response = model_with_tools.invoke(messages)
```

LLM 将响应一个工具调用请求：

```python
messages.append(response)
response.tool_calls[0]
```

```text
{'name': 'family_query',
 'args': {'men': 'john', 'women': None, 'child': None},
 'id': 'call_gH8rWamYXITrkfvRP2s5pkbF',
 'type': 'tool_call'}
```

该工具接收此请求并查询 Prolog 数据库：

```python
tool_msg = prolog_tool.invoke(response.tool_calls[0])
```

该工具返回一个包含查询所有解的列表：

```python
messages.append(tool_msg)
tool_msg
```

```text
ToolMessage(content='[{"Women": "bianca", "Child": "mary"}, {"Women": "bianca", "Child": "michael"}]', name='family_query', tool_call_id='call_gH8rWamYXITrkfvRP2s5pkbF')
```

然后我们将其传递给 LLM，LLM 使用工具响应来回答原始查询：

```python
answer = model_with_tools.invoke(messages)
print(answer.content)
```

```text
John has two children: Mary and Michael, with Bianca as their mother.
```

## 链式调用

### 将 Prolog 工具与智能体（agent）结合使用

要将 Prolog 工具与智能体一起使用，请将其传递给智能体的构造函数：

```python
#!pip install langgraph

from langchain.agents import create_agent

agent_executor = create_agent(model, [prolog_tool])
```

智能体接收查询并在需要时使用 Prolog 工具：

```python
messages = agent_executor.invoke({"messages": [("human", query)]})
```

然后智能体接收工具响应并生成答案：

```python
messages["messages"][-1].pretty_print()
```

```text
================================== Ai Message ==================================

John has two children: Mary and Michael, with Bianca as their mother.
```

---

## API 参考

详情请参阅 [langchain-prolog.readthedocs.io/en/latest/modules.html](https://langchain-prolog.readthedocs.io/en/latest/modules.html)。
